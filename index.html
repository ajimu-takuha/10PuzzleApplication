<!DOCTYPE html>
<html>

<head>
    <title>10PUZZLE(make10Application)</title>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="js/make10.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="area" class="area">
        <div id="particles-js">
        </div>


        <div id="all" class="all">
            <div v-if="isLoading" class="overlay"></div>
            <div class="contentWrapper">

                <div id="subMenuOverlay" v-if="subMenuFlag" class="subMenuOverlay"></div>
                <transition name="fade">
                    <div v-if="showCorrect" class="correct-text">
                        {{ correctText }}
                    </div>
                </transition>



                <div id="menu" class="result" v-if="menuFlag">
                    <div id="itemCovorMenu">
                        <div id="titleAndCloseMenu" class="titleAndClose">
                            <div id="menuTitle">
                                <span style="color: rgb(255, 255, 255)">
                                    Menu
                                </span>
                            </div>
                            <div class="closeWrapper" v-on:click="closeMenu()">
                            </div>
                            <button id="closeMenu" class="closeButton"></button>
                        </div>
                    </div>
                    <button id="rankingButton" class="menuContent" v-on:click="showRanking()">Ranking</button>
                    <button id="configButton" class="menuContent" v-on:click="showConfig()">
                        Config
                    </button>
                    <button id="showHTPButton" class="menuContent" v-on:click="showHowToPlay()">
                        How to Play
                    </button>
                </div>



                <div id="config" class="result" v-if="configFlag">
                    <div class="itemCovor">
                        <div class="titleAndClose">
                            <div id="configTitle" class="rankingTitle" style="color: rgb(255, 255, 255)">Config
                            </div>
                            <div class="closeWrapper" v-on:click="closeConfig()">
                            </div>
                            <button id="closeConfig" class="closeButton"></button>
                        </div>
                        <div class="configItem">
                            <div id="configSpace" class="items">

                            </div>
                            <div class="changePart items">
                                Changes
                            </div>
                            <div class="assigned items">
                                Key 1
                            </div>
                            <div class="assigned items">
                                Key 2
                            </div>
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            <span class="changes"> + </span> ○ + ○ + ○ + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(0,0)">
                            {{ getEventKeyValue(0, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(0,1)">
                            {{ getEventKeyValue(0, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○<span class="changes"> + </span>○ + ○ + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(1,0)">
                            {{ getEventKeyValue(1, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(1,1)">
                            {{ getEventKeyValue(1, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + ○<span class="changes"> + </span>○ + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(2,0)">
                            {{ getEventKeyValue(2, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(2,1)">
                            {{ getEventKeyValue(2, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + ○ + ○<span class="changes"> + </span>○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(3,0)">
                            {{ getEventKeyValue(3, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(3,1)">
                            {{ getEventKeyValue(3, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + <span class="changes">○</span> + ○ + ○ + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(4,0)">
                            {{ getEventKeyValue(4, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(4,1)">
                            {{ getEventKeyValue(4, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + <span class="changes">○</span> + ○ + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(5,0)">
                            {{ getEventKeyValue(5, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(5,1)">
                            {{ getEventKeyValue(5, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + ○ + <span class="changes">○</span> + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(6,0)">
                            {{ getEventKeyValue(6, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(6,1)">
                            {{ getEventKeyValue(6, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + ○ + ○ + <span class="changes">○</span>
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(7,0)">
                            {{ getEventKeyValue(7, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(7,1)">
                            {{ getEventKeyValue(7, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            <span class="changes"> ( </span>+ ○ + ○ <span class="changes"> ) </span> + ○ + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(8,0)">
                            {{ getEventKeyValue(8, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(8,1)">
                            {{ getEventKeyValue(8, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            <span class="changes"> ( </span>+ ○ + ○ + ○<span class="changes"> ) </span> + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(9,0)">
                            {{ getEventKeyValue(9, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(9,1)">
                            {{ getEventKeyValue(9, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + <span class="changes"> ( </span>○ + ○<span class="changes"> ) </span> + ○
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(10,0)">
                            {{ getEventKeyValue(10, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(10,1)">
                            {{ getEventKeyValue(10, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + <span class="changes"> ( </span>○ + ○+ ○<span class="changes"> ) </span>
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(11,0)">
                            {{ getEventKeyValue(11, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(11,1)">
                            {{ getEventKeyValue(11, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            + ○ + ○ + <span class="changes"> ( </span>○+ ○<span class="changes"> ) </span>
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(12,0)">
                            {{ getEventKeyValue(12, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(12,1)">
                            {{ getEventKeyValue(12, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            Start/GiveUp
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(13,0)">
                            {{ getEventKeyValue(13, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(13,1)">
                            {{ getEventKeyValue(13, 1) }}
                        </div>
                    </div>

                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            Reload
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(14,0)">
                            {{ getEventKeyValue(14, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(14,1)">
                            {{ getEventKeyValue(14, 1) }}
                        </div>
                    </div>
                    <div class="configItem">
                        <div class="configSpace">
                        </div>
                        <div class="changePart items">
                            Reset
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(15,0)">
                            {{ getEventKeyValue(15, 0) }}
                        </div>
                        <div class="assigned items keys" v-on:click="startEditing(15,1)">
                            {{ getEventKeyValue(15, 1) }}
                        </div>
                    </div>


                    <button class="configContent" v-on:click="resetConfigDefault()">Reset Assigned Keys to Default
                    </button>

                    <button class="configContent" v-on:click="inputModeChange()">Arithmetic Operator Change : {{
                        inputMode }}
                    </button>

                    <button class="configContent" v-on:click="clearEffectChange()">Effect : {{
                        clearEffectFlag }}
                    </button>
                </div>


                <!-- <div id="correctCube"></div> -->

                <div id="explanation" class="explanation" v-if="HTPFlag">
                    <div id="itemCovorHTP" class="itemCovor">
                        <div id="titleAndCloseHTP" class="titleAndClose">
                            <div id="howToPlayTitle" class="rankingTitle">
                                <span style="color: rgb(255, 255, 255)">
                                    How to Play
                                </span>
                            </div>
                            <div class="closeWrapper" v-on:click="closeHowToPlay()">
                            </div>
                            <button id="closeHowToPlay" class="closeButton"></button>
                        </div>
                    </div>
                    <p>
                        <br>
                        <br>
                        これは
                        <span style="font-size: 30px;">
                            「10パズル」
                        </span>
                        というゲームに着想を得たアプリです<br>
                        与えられた4つの数字に対して、四則演算子と括弧を用いて<br>
                        いかに早く10になる式を作れるか競います<br>
                        <span style="font-size: 20px; line-height: 15px;">
                            ※ 続きはこの画面をスクロール<br></span>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        右上にある記号をクリックするとこの画面を終了します<br>
                        終了後タイトルをクリックするとメニュー画面に移り<br>
                        「How to Play」を押すとこの画面を再び表示します<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 100px;">操作方法</span>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        「Start」ボタンを押すとスコア計測が始まり問題が表示されます<br>
                        一度押した「Start」ボタンは「Give Up」ボタンとなり<br>
                        それを押すと挑戦を放棄してそれまでの結果を確認できます<br>
                        <br>
                        後述するキーバインドの仕様上一度Startすると挑戦終了まで<br>
                        F5等キー本来の持っている画面操作は使えません<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        画面には初めに「+」演算子が表示されていますが<br>
                        クリックするたび [ - , ×, ÷, + ] の順に変更され<br>
                        計算結果が自動で変更されます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        数字をクリックすると背景色が変更されますが<br>
                        その状態で別の数字をクリックすると<br>
                        数字の位置を入れ替えることができます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        画面上には括弧のペア　"
                        <span style="font-size: 40px; color: rgb(255, 255, 255);">
                            (　)
                        </span>
                        "　が入る位置があり<br>
                        そこにマウスが乗ると背景色が変更され<br>
                        クリックするとそこに括弧が入ります<br>
                        再び括弧をクリックするとすべての括弧が消えます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        「Reload」ボタンは今解いている問題を放棄して<br>
                        次の問題を表示させます<br>
                        一度の挑戦で使用できるのは20回までで<br>
                        使用するたびにスコアが20ずつ下がります<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        「Reset」ボタンは出題時から変更した<br>
                        数字順・括弧・記号をすべて出題時の状態に戻します<br>
                        使用することにペナルティはありません<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        また、キーボードにより操作することもできます<br>
                        タイトルをクリックするとメニュー画面が表示され<br>
                        そこから「Config」をクリックすると<br>
                        操作に対するキーの割り当てを確認・変更できます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        10問正解すると挑戦終了となりスコアが表示されます<br>
                        スコアの算出方法は減点方式で<br>
                        1000 - ( 経過時間 + 20 ×リロード回数 ) で算出されます<br>
                        問題生成やクリア時のエフェクトは経過時間に含まれません<br>
                        スコアが0以下になると強制的にGiveUpとなります<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        リザルト画面で「Detail」ボタンを押すと<br>
                        プレイヤーが解いた問題と各解答時間が表示されます<br>
                        「Reload」ボタンを押した問題は赤色で表示されます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        リザルト画面で「Registration」ボタンを押すと<br>
                        1~12文字の名前とスコアを登録することができます<br>
                        公序良俗に反する名前は使用しないでください<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 100px;">各種設定</span>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        難易度は
                        <span style="font-size: 40px; color: yellow;">Easy </span>
                        <span style="font-size: 40px; color: green;">Normal </span>
                        <span style="font-size: 40px; color: blue;">Hard </span>
                        <span style="font-size: 40px; color: red;">Lunatic </span>
                        の4種類
                        <br>
                        画面下にあるボタンのクリックで変更できます<br>
                        <span style="font-size: 20px; line-height: 15px;">
                            ※ Lunatic は初期状態では選択できません<br></span>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 30px; color: yellow;">Easy </span>
                        では1~9までの数字を用い<br>
                        括弧を使わず演算子を1~2か所変更するだけで10になります<br>
                        <span style="font-size: 20px; line-height: 15px;">
                            ※ 解答に「 ×」もしくは「 ÷」記号を用いる場合は1か所の変更で<br>
                            解答に「-」記号を用いる場合は1~2か所変更することで10にできます<br></span>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 30px; color: green;">Normal</span>
                        では1~9までの数字を用い<br>
                        演算子を2か所以上変更するか<br>
                        演算子1か所のみの変更でも括弧を用いる必要があります<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 30px; color: blue;">Hard</span>
                        では1~19までの数字を用い<br>
                        演算子を2か所以上変更するか<br>
                        演算子1か所のみの変更でも括弧を用いる必要があります<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 30px; color: red;">Lunatic</span>
                        は非常に難しいモードです<br>
                        Normal 以上の難易度で一定スコアを獲得すると選択できます<br>
                        ぜひプレイできるようになってください<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 100px;">Menu画面詳細</span>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        タイトルをクリックするとMenu画面に移ります<br>
                        「Ranking」ボタンを押すとモード別ランキングが見られます<br>
                        「Config」ボタンを押すとキー操作の割り当て等ができます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        Ranking画面はモード別スコア順にプレイヤーが表示されます<br>
                        データをクリックするとプレイヤーの解いた問題が見られます<br>
                        画面下のボタンを押すと表示するランキングが変わります<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        Config画面では赤で示した部分を操作するキーを設定します<br>
                        各操作2種類のキーまで登録可能することができます<br>
                        <br>
                        <br>
                        光る部分をクリックすると「Input Key」と出るので<br>
                        その状態で任意のキーを押下すると割り当てることができます<br>
                        3秒間入力が無ければ割り当て操作を取り消します<br>
                        <br>
                        <br>
                        割り当てたキーが既に使用されていた場合は<br>
                        先に割り当てていたキーが無効化されます<br>
                        <br>
                        <br>
                        Start/GiveUpに割り当てたキーは<br>
                        GiveUp後の詳細画面を閉じることもできます<br>
                        <br>
                        <br>
                        Cookieを消去するなどのブラウザ機能を利用するまで<br>
                        変更したキー割り当てはサイトを閉じても維持されます<br>
                        (Lunaticモードを解放した際も同様に状態が維持されます)<br>
                        <br>
                        <br>
                        「Reset Assigned Keys to Default」をクリックすると<br>
                        キーの割り当てがデフォルト状態に戻ります<br>
                        <br>
                        <br>
                        「Arithmetic Operator Change」をクリックすると<br>
                        演算子のマウス入力をフリックに変更できます<br>
                        マウス入力がフリックの場合は演算子をクリック後<br>
                        右：＋　左：‐　上：×　下：÷　<br>
                        のようにフリック方向によって演算子が変更されます<br>
                        <br>
                        <br>
                        「Effect」をクリックすると正解時の演出を消せます<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <span style="font-size: 100px;">以下あとがき</span><br>
                        <span style="font-size: 50px;">---------------------------------------
                        </span><br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        社内ポータルで使うvue.jsの練習として適当に作って<br>
                        と言われたのがきっかけでしたが、こんなになるとは...<br>
                        <br>
                        <br>
                        とりあえず10問正解の時間を計りたいと思って作り始め<br>
                        <br>
                        <br>
                        答えを見たいから解答表示機能を作り<br>
                        <br>
                        <br>
                        1問分からないだけで終了はどうかと思って<br>
                        リロード機能を作り<br>
                        <br>
                        <br>
                        リロードにペナルティはほしいと思って<br>
                        スコアを作り<br>
                        <br>
                        <br>
                        自分のスコアを残したいからランキングを作ろうと考えて<br>
                        <br>
                        <br>
                        プレイが運に左右されすぎないようにと<br>
                        問題生成の処理を修正し<br>
                        <br>
                        <br>
                        問題生成時間のばらつきが<br>
                        タイムに影響を及ぼさないよう修正し<br>
                        <br>
                        <br>
                        何度もクリックして演算子変更するよりも<br>
                        一回の動作で演算子を変えたいと思ってフリック入力を作り<br>
                        <br>
                        <br>
                        それ以前にマウスの移動が時間のロスにつながると考えて<br>
                        キーボード入力を作り<br>
                        <br>
                        <br>
                        キーボード入力をするなら最適な構成を考えたいと思い<br>
                        割り当て機能を作り<br>
                        <br>
                        <br>
                        画面にタイマーを表示していたけれど<br>
                        スコアを直接表示した方がいいと思って修正し...<br>
                        <br>
                        <br>
                        何も考えないで作るもんじゃないですね<br>
                        <br>
                        <br>
                        結局このアプリに自分が求めていたのは<br>
                        <span style="font-size: 35px;">
                            いかに自分の能力を損失なく数値に変換できるか<br>
                        </span>
                        ということでした<br>
                        それを念頭に仕様を考えればよかったですね...<br>
                        <br>
                        <br>
                        外部APIを使うランキングの実装が一番大変でした<br>
                        ChatGPT君がいなければ<br>
                        実装できない処理がたくさんあったと思います<br>
                        <br>
                        <br>
                        正解時の演出やUI、装飾については<br>
                        色々考えましたがあまり満足はしていません<br>
                        もっといい案誰かください<br>
                        <br>
                        <br>
                        Googleが2013年に<br>
                        「1, 1, 5, 8」で10を作れるか？<br>
                        という広告を出して話題になった10パズル<br>
                        <br>
                        <br>
                        答えを考えるのも楽しいし<br>
                        分からなかったとしても解法を見て<br>
                        「それがあったか～」とよく思います<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        "シコウ"を楽しんでみてください<br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        <br>
                        バグの報告や要望・感想等がもしあれば<br>
                        <a href="mailto:decoy.dummy.ac@gmail.com">decoy.dummy.ac@gmail.com</a><br>
                        までご連絡ください<br>
                        <br>
                        <br>
                        <br>
                    </p>
                </div>
                <div id="result" class="result" v-if="resultFlag">
                    <div id="scoreWrap">
                        <div class="textSpaceFix">
                            <div class="scoreContentName">
                                Mode :
                            </div>
                            <div class="scoreContent">
                                {{mode}}
                            </div>
                        </div>

                        <div class="textSpaceFix">
                            <div class="scoreContentName">
                                Time :
                            </div>
                            <div class="scoreContent">
                                {{elapsedTime}}
                            </div>
                        </div>

                        <div class="textSpaceFix">
                            <div class="scoreContentName">
                                Reload :
                            </div>
                            <div class="scoreContent">
                                {{20 - reloadCount}}
                            </div>
                        </div>

                        <div class="textSpaceFix">
                            <div class="scoreContentName">
                                Score :
                            </div>
                            <div class="scoreContent">
                                {{score}}
                            </div>
                        </div>
                    </div>
                    <div id="evaluation">{{evaluation}}</div>
                    <div id="evalComment">
                        {{evalComment}}
                    </div>
                    <div id="resultButtonWrapper">
                        <button id="inputUser" class="resultButton" v-on:click="moveRegistScreen()">
                            Registration
                        </button>
                        <button id="checkDetail" class="resultButton" v-on:click="checkDetail()">
                            Detail
                        </button>
                    </div>
                    <div class="closeWrapper" v-on:click="closeResult()">
                    </div>
                    <button id="closeResult"></button>
                </div>
                <template v-if="checkDetailFlag">
                    <div id="detailScreen" class="result">
                        <span id="resultDetailTitle">Result Details</span>
                        <div v-for="(detail, index) in answerDetail"
                            v-bind:style="{ backgroundColor: detail.reload == true ? 'rgba(255, 0, 51, 0.6)' : '' }"
                            id="detailWrapper">
                            <div class="solvedNum" v-bind:style="{ fontSize: mode == 'Lunatic' ? '30px' : '' }">
                                {{"Q." + (Number(index) + 1 + "")}}
                            </div>
                            <div class="solvedFormula" v-if="mode !== 'Lunatic'">
                                {{ (detail.formula).join(" , ").split('').join("") }}
                            </div>
                            <div class="solvedFormula" v-if="mode == 'Lunatic'" style="font-size: 32px;">
                                {{ (detail.formula).join(", ").split('').join("") }}
                            </div>

                            <div class="lunaticTarget" v-if="mode == 'Lunatic'" style="font-size: 32px">
                                <div>
                                    <span style="font-size: 32px;">[ </span>{{(detail.target) }}
                                    <span style="font-size: 32px;"> ]</span>
                                </div>
                            </div>

                            <div class="detailAnswerFormula" v-if="mode !== 'Lunatic'">
                                {{ (detail.answer.replace("return", "").replace(/\*/g, "×").replace(/\//g,
                                "÷")).split('').join(' ') }}
                            </div>
                            <div class="detailAnswerFormula" v-if="mode == 'Lunatic'" style="font-size: 32px;">
                                {{ (detail.answer.replace("return", "").replace(/\*/g, "×").replace(/\//g,
                                "÷")).split('').join('') }}
                            </div>
                            <div class="intervalTime" v-bind:style="{ fontSize: mode =='Lunatic' ? '32px' : '' }">
                                {{ detail.intervalTime + "s"}}
                            </div>
                        </div>
                        <button id="closeDetail" class="backButton" v-on:click="closeDetail()">←
                        </button>
                </template>
                <div v-if="registFlag">
                    <div id="registScreen" class="result">
                        <button id="closeRegist" class="backButton " v-on:click="closeRegist()">←
                        </button>
                        <div id="registTitle" cless="registTitle">Ranking Registration</div>
                        <div style="margin-top: 40px;">　Score : {{score}}　</div>
                        <div>
                            <input type="text" id="registName" name="registName" maxlength="12" required>
                        </div>
                        <div id="warningWrapper">
                            <div id="normalText" style="font-size: 30px" style="font-size: 20px">1～12 characters can be
                                input
                            </div>
                            <p id="warning" style="display: none">
                                Enter your name !
                            </p>
                        </div>
                        <button id="registButton" v-on:click="regist()">Registration
                        </button>
                    </div>
                </div>
                <div id="ranking" class="result" v-if="rankingFlag">
                    <div class="itemCovor">
                        <div class="titleAndClose">
                            <div id="rankingTitle" class="rankingTitle">
                                <span style="color: rgb(255, 0, 0)">
                                    {{rankingDisplayMode[modeIndex % rankingDisplayMode.length] }}
                                </span>
                                Ranking
                            </div>
                            <div class="closeWrapper" v-on:click="closeRanking()">
                            </div>
                            <button id="closeRanking" class="closeButton"></button>
                        </div>
                        <div id="rankingItem">
                            <div id="space" class="items">

                            </div>
                            <div id="nameItem" class="items">
                                Name
                            </div>
                            <div id="scoreItem" class="items">
                                Score
                            </div>
                            <div id="dateItem" class="items">
                                Date
                            </div>
                        </div>
                    </div>
                    <div id="rankingContentEasy" class="rankingContent" v-if="showRankingEasy">
                        <div id="rankDetail" class="rankDetail" v-for="(data, index) in rankingDataEasy.data"
                            v-on:click="showUserQuestion(index)">
                            <div id="rankNum" class="rankVal">
                                <span>
                                    {{ index + 1 }}
                                </span>
                            </div>
                            <div id="rankName" class="rankVal">
                                <span>
                                    {{ data[0] }}
                                </span>
                            </div>
                            <div id="rankScore" class="rankVal">
                                <span>
                                    {{ data[1] }}
                                </span>
                            </div>
                            <div id="rankDate" class="rankVal">
                                <span>
                                    {{ data[2] }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div id="rankingContentNormal" class="rankingContent" v-if="showRankingNormal">
                        <div id="rankDetail" class="rankDetail" v-for="(data, index) in rankingDataNormal.data"
                            v-on:click="showUserQuestion(index)">
                            <div id="rankNum" class="rankVal">
                                <span>
                                    {{ index + 1 }}
                                </span>
                            </div>
                            <div id="rankName" class="rankVal">
                                <span>
                                    {{ data[0] }}
                                </span>
                            </div>
                            <div id="rankScore" class="rankVal">
                                <span>
                                    {{ data[1] }}
                                </span>
                            </div>
                            <div id="rankDate" class="rankVal">
                                <span>
                                    {{ data[2] }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div id="rankingContentHard" class="rankingContent" v-if="showRankingHard">
                        <div id="rankDetailHard" class="rankDetail" v-for="(data, index) in rankingDataHard.data"
                            v-on:click="showUserQuestion(index)">
                            <div id="rankNum" class="rankVal">
                                <span>
                                    {{ index + 1 }}
                                </span>
                            </div>
                            <div id="rankName" class="rankVal">
                                <span>
                                    {{ data[0] }}
                                </span>
                            </div>
                            <div id="rankScore" class="rankVal">
                                <span>
                                    {{ data[1] }}
                                </span>
                            </div>
                            <div id="rankDate" class="rankVal">
                                <span>
                                    {{ data[2] }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div id="rankingContentOD" class="rankingContent" v-if="showRankingLunatic">
                        <div id="rankDetailOD" class="rankDetail" v-for="(data, index) in rankingDataOD.data"
                            v-on:click="showUserQuestion(index)">
                            <div id="rankNum" class="rankVal">
                                <span>
                                    {{ index + 1 }}
                                </span>
                            </div>
                            <div id="rankName" class="rankVal">
                                <span>
                                    {{ data[0] }}
                                </span>
                            </div>
                            <div id="rankScore" class="rankVal">
                                <span>
                                    {{ data[1] }}
                                </span>
                            </div>
                            <div id="rankDate" class="rankVal">
                                <span>
                                    {{ data[2] }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <button id="rankngModeChange" class="modeChangeButton" v-on:click="rankingModeChange()">Click : {{
                        rankingDisplayMode[(modeIndex + 1) % rankingDisplayMode.length] }}
                    </button>
                </div>
                <div v-if="rankingDetailFlag" class="result">
                    <div id="rankingDetailTitle">User Details</div>
                    <div v-for="(detail, index) in rankingUserDetail"
                        v-bind:style="{ backgroundColor: detail.reload == true ? 'rgba(255, 0, 51, 0.6)' : '' }"
                        id="detailWrapper">
                        <div class="solvedNum" v-bind:style="{ fontSize: showRankingLunatic ? '30px' : '' }">
                            {{"Q." + (Number(index) + 1 + "")}}
                        </div>
                        <div class="solvedFormula">
                            <div v-if="!showRankingLunatic">
                                {{ (detail.formula).join(" , ").split('').join("") }}
                            </div>
                            <div v-if="showRankingLunatic" style="font-size: 32px;">
                                {{ (detail.formula).join(", ").split('').join("") }}
                            </div>
                        </div>

                        <div class="lunaticTarget" v-if="showRankingLunatic" style="font-size: 32px">
                            <div>
                                <span style="font-size: 32px;">[ </span>{{(detail.target) }}
                                <span style="font-size: 32px;"> ]</span>
                            </div>
                        </div>

                        <div class="detailAnswerFormula">
                            <div v-if="!showRankingLunatic">
                                {{ (detail.answer.replace("return", "").replace(/\*/g, "×").replace(/\//g,
                                "÷")).split('').join(' ') }}
                            </div>
                            <div v-if="showRankingLunatic" style="font-size: 32px;">
                                {{ (detail.answer.replace("return", "").replace(/\*/g, "×").replace(/\//g,
                                "÷")).split('').join('')}}
                            </div>
                        </div>
                        <div class="intervalTime" v-bind:style="{ fontSize: showRankingLunatic ? '32px' : '' }">
                            {{ detail.intervalTime + "s"}}
                        </div>
                    </div>
                    <button id="closeRankingDetail" class="backButton" v-on:click="closeRankingDetail()">←
                    </button>
                </div>
                <!-- <div id="answerFormula" class="answerFormula">
                    {{answerFormula}}={{target}}<br>
                    <button id="tryButton" class="tryButton" v-on:click="tryAgain()">Try Again</button>
                </div>
                <div id="answerNoChange" class="answerNoChange" v-if="answerChangeFlag">
                </div> -->
                <div id="header" v-bind:class="{'headerIsStarted': startFlag}" @mouseover="handleMouseOver"
                    @mouseleave="handleMouseLeave">
                    <div class="title" v-if="!isHoveredTitle && mode !== 'Lunatic'">
                        {{ title }}
                    </div>
                    <div class="lunaticTitle" v-if="!isHoveredTitle && mode == 'Lunatic'">
                        {{ target + " Puzzle"}}
                    </div>
                    <div class="hovorTitle" v-if="isHoveredTitle" v-on:Click="showMenu()">
                        Menu
                    </div>
                </div>
                <div id="clearCount" v-bind:class="{'LunaticCount':mode == 'Lunatic', 'clearCount':mode != 'Lunatic'}">
                    Clear :　{{ clearCount }}　　　Reload :　{{ reloadCount }}
                    <div id="targetNum"
                        v-bind:class="{'LunaticCount':mode == 'Lunatic', 'targetNum':mode != 'Lunatic'}">
                        　　　Target :　{{target}}</div>
                </div>
                <div id="formulaBody">
                    <div id="firstBra" @mouseenter="isHovered0 = true" @mouseleave="isHovered0 = false"
                        v-bind:class="{'hovered0': isHovered0, 'hovered3': isHovered3, 'LunaticBra':mode == 'Lunatic', 'brackets formula':mode != 'Lunatic'}"
                        v-on:click="braChange(0)">
                        {{ brackets[0] }}
                    </div>

                    <div :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }" id="addSym" class="symbol"
                        v-on:click="addSymChange">
                        {{ addSym[0] }}
                    </div>

                    <div id="firstN" type="text" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        v-bind:class="{'LunaticCAct':LunaticNBChange[0], 'clickAct':numBackChange[0], 'LunaticNum':mode == 'Lunatic', 'numbers formula':mode != 'Lunatic'}"
                        v-on:click="numReplace('first')">
                        {{ numbers[0]}}
                    </div>

                    <div id="firstSymbol" class="symbol" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        :class="{dragging: isDragging && selectedSym === 0 }" @mousedown="startDrag(0, $event)"
                        @mousemove="drag($event)" @mouseup="endDrag" @mouseleave="endDrag" @click="changeOpeClick(0)"
                        ref="draggable0">
                        {{ symValue[0] }}
                    </div>

                    <div id="secondBra" @mouseenter="isHovered1 = true" @mouseleave="isHovered1 = false"
                        v-bind:class="{'hovered1': isHovered1, 'hovered4': isHovered4, 'LunaticBra':mode == 'Lunatic', 'brackets formula':mode != 'Lunatic'}"
                        v-on:click="braChange(1)">
                        {{ brackets[1] }}
                    </div>

                    <div id="secondN" type="math" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        v-bind:class="{'LunaticCAct':LunaticNBChange[1], 'clickAct':numBackChange[1], 'LunaticNum':mode == 'Lunatic', 'numbers formula':mode != 'Lunatic'}"
                        v-on:click="numReplace('second')">
                        {{ numbers[1] }}
                    </div>

                    <div @mouseenter="isHovered0 = true" @mouseleave="isHovered0 = false"
                        v-bind:class="{'hovered0': isHovered0,  'LunaticBra':mode == 'Lunatic', 'brackets formula':mode != 'Lunatic'}"
                        id="thirdBra" v-on:click="braChange(2)">
                        {{ brackets[2] }}
                    </div>

                    <div id="secondSymbol" class="symbol" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        :class="{ dragging: isDragging && selectedSym === 1 }" @mousedown="startDrag(1, $event)"
                        @mousemove="drag($event)" @mouseup="endDrag" @mouseleave="endDrag" @click="changeOpeClick(1)"
                        ref="draggable1">
                        {{ symValue[1] }}
                    </div>

                    <div @mouseenter="isHovered2 = true" @mouseleave="isHovered2 = false"
                        v-bind:class="{'hovered2': isHovered2, 'LunaticBra':mode == 'Lunatic', 'brackets formula':mode != 'Lunatic'}"
                        id="forthBra" v-on:click="braChange(3)">
                        {{ brackets[3] }}
                    </div>

                    <div type="math" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        v-bind:class="{'LunaticCAct':LunaticNBChange[2], 'clickAct':numBackChange[2], 'LunaticNum':mode == 'Lunatic', 'numbers formula':mode != 'Lunatic'}"
                        id="thirdN" v-on:click="numReplace('third')">
                        {{ numbers[2] }}
                    </div>

                    <div @mouseenter="isHovered3 = true" @mouseleave="isHovered3 = false"
                        v-bind:class="{'hovered1': isHovered1,  'hovered3': isHovered3, 'LunaticBra':mode == 'Lunatic', 'brackets formula':mode != 'Lunatic'}"
                        id="fifthBra" v-on:click="braChange(4)">
                        {{ brackets[4] }}
                    </div>

                    <div id="thirdSymbol" class="symbol" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        :class="{ dragging: isDragging && selectedSym === 2 }" @mousedown="startDrag(2, $event)"
                        @mousemove="drag($event)" @mouseup="endDrag" @mouseleave="endDrag" @click="changeOpeClick(2)"
                        ref="draggable2">
                        {{ symValue[2] }}
                    </div>

                    <div type="math" :style="{ color: mode === 'Lunatic' ? 'rgb(180, 0, 0)' : '' }"
                        v-bind:class="{'LunaticCAct':LunaticNBChange[3], 'clickAct':numBackChange[3], 'LunaticNum LunaticLastNum':mode == 'Lunatic', 'numbers formula':mode != 'Lunatic'}"
                        id="fourthN" v-on:click="numReplace('fourth')">
                        {{ numbers[3] }}
                    </div>

                    <div @mouseenter="isHovered4 = true" @mouseleave="isHovered4 = false"
                        v-bind:class="{'hovered2': isHovered2, 'hovered4': isHovered4, 'LunaticBra':mode == 'Lunatic', 'brackets formula':mode != 'Lunatic'}"
                        id="sixthBra" v-on:click="braChange(5)" style="width:50px">
                        {{ brackets[5] }}
                    </div>

                    <div v-bind:class="{'lunaticEcole':mode == 'Lunatic', 'ecole':mode != 'Lunatic'}" id="ecole">=
                    </div>

                    <div id="answerWrap">
                        <div class="formula" id="answer"
                            v-bind:class="{'answer': mode != 'Lunatic', 'LunaticAnswer': mode == 'Lunatic'}">
                            {{answer}}
                        </div>
                    </div>
                </div>
                <div id="buttonWrapper">
                    <!-- <button type="button" id="showAnsButton" v-on:click="showAns()"
                        v-bind:class="{'inactive': isStart, 'lunaticButton LunaticStartButton':mode == 'Lunatic', 'buttons startButton':mode != 'Lunatic'}">Show
                        Answer</button> -->
                    <button type="button" id="startButton" v-on:click="startOrGiveUp()"
                     v-bind:class=" {'lunaticButton LunaticStartButton':mode=='Lunatic'
                        , 'buttons startButton' :mode !='Lunatic' }">
                        <div class="diamondText">
                            <span v-if="isStart">Give Up</span>
                            <span v-else>Start</span>
                        </div>
                    </button>
                    <button type="button"
                        v-bind:class="{'lunaticButton ':mode == 'Lunatic', 'buttons reloadButton':mode != 'Lunatic', 'disabledButton': reloadCount == 0 || startFlag !== true || disableButton}"
                        id="reloadButton" v-on:click="reloadClick(); createNum()">
                        <div class="diamondText">
                            Reload
                        </div>
                    </button>
                    <button type="button"
                        v-bind:class="{'lunaticButton':mode == 'Lunatic', 'buttons':mode != 'Lunatic', 'disabledButton': startFlag !== true}"
                        id="resetButton" v-on:click="resetFormula">
                        <div class="diamondText">
                            Reset
                        </div>
                    </button>
                </div>
                <div id="modeWrapper">
                    <button v-bind:class="{modeButtons: true, EasylButton: true, btnIsSelect: btnIsSelect[6]}"
                        v-on:click="modeChangeEasy">Easy</button>
                    <button v-bind:class="{modeButtons: true, NormalButton: true, btnIsSelect: btnIsSelect[3]}"
                        v-on:click="modeChangeNormal">Normal</button>
                    <button v-bind:class="{modeButtons :true, HardsButton: true, btnIsSelect: btnIsSelect[4]}"
                        v-on:click="modeChangeHard">Hard</button>
                    <button id="lunaticButton" class="lunaticModeChangeButton" v-bind:class="{ lunaticIsSelected: btnIsSelect[5], 
                        }" v-on:click="modeChangeLunatic">Lunatic</button>
                </div>
                <div class="controls">
                    <div v-bind:class="{'LunaticTimer':mode == 'Lunatic', 'timer':mode != 'Lunatic'}">
                        <span v-for="(char, index) in formattedScore" :key="index">
                            {{ char }}
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- <script src="js/backgroundCSS.js"></script> -->
    <script type="text/javascript" src="js/particles.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
    <script src="airtable.js"></script>
</body>
<script>
    "use strict"
    // import axios from "axios";
    const eventBus = new Vue();

    var all = new Vue({
        el: "#all",
        data: {
            title: "10 Puzzle",
            numbers: ["", "", "", ""],
            passNum: ["first", "second", "third", "fourth", "fifth", "sixth"],
            selectedNum: ["", "", "", "", "", ""],
            numBackChange: [false, false, false, false, false, false],
            LunaticNBChange: [false, false, false, false, false, false],
            selectedNumIndexF: -1,
            selectedNumTF: false,
            bracketNames: [
                "firstBra",
                "secondBra",
                "thirdBra",
                "fourthBra",
                "fifthBra",
                "sixthBra",
            ],
            checkDupNums: [],
            brackets: ["", "", "", "", "", ""],
            selectedBra: ["", "", "", "", "", ""],
            isHovered0: false,
            isHovered1: false,
            isHovered2: false,
            isHovered3: false,
            isHovered4: false,
            isHovered5: false,
            firstSym: ["+"],
            secondSym: ["+"],
            thirdSym: ["+"],
            addSym: ["+"],
            symValue: ["+", "+", "+"],
            clearCount: 0,
            questionCount: 0,
            clearedFormula: [
                [3, 4, 7, 8],
                [1, 1, 5, 8],
            ],
            reloadFormula: [],
            reloadAnswerFormula: [],
            answerDetail: [],
            reloadCount: 20,
            answerFormula: "",
            selectFlag: false,
            startFlag: false,
            ansFlag: false,
            clickAct: [false, false, false, false, false, false],
            LunaticCAct: [false, false, false, false, false, false],
            btnIsSelect: [false, false, false, true, false, false, false],
            mode: "Normal",
            target: 10,
            score: "1000.0",
            evaluation: "",
            evalComment: "",
            time: "00:00:000",
            startTime: 0,
            createQuestionTime: 0,
            pausedTimeStart: 0,
            pausedTimeEnd: 0,
            totalPausedTime: 0,
            totalTime: 0,
            elapsedTime: 0,
            isStart: false,
            isStop: true,
            isReset: true,
            isPaused: false,
            timeoutId: 0,
            menuFlag: false,
            rankingFlag: false,
            resultFlag: false,
            checkDetailFlag: false,
            registFlag: false,
            rankingDetailFlag: false,
            rankingData: [],
            rankingUserDetail: [],
            isDragging: false,
            startPosition: { x: 0, y: 0 },
            position: { x: 0, y: 0 },
            lastMousePos: null,
            mouseThreshold: 7,
            selectedSym: null,
            apiKey:
                "patLECZIq2tF3NhKk.e5c426974a99e1e06e1d6e6122d6a76cdb76996c9115fb96316c1471092e11d1",
            baseId: "app1MxnFrdKWBio9q",
            tableName: "name",
            rankingDataEasy: [],
            rankingDataNormal: [],
            rankingDataHard: [],
            rankingDataOD: [],
            showRankingEasy: false,
            showRankingNormal: true,
            showRankingHard: false,
            showRankingLunatic: false,
            rankingDisplayMode: ["Easy", "Normal", "Hard", "Lunatic"],
            inputMode: "Click",
            modeIndex: 1,
            elements: [
                'firstBra', 'addSym', 'firstN', 'firstSymbol', 'secondBra', 'secondN', 'thirdBra', 'secondSymbol',
                'forthBra', 'thirdN', 'fifthBra', 'thirdSymbol', 'fourthN', 'sixthBra', 'ecole', 'answer'
            ],
            index: 0,
            disableButton: false,
            showCorrect: false,
            correctText: "Correct!",
            clearEffectFlag: "on",
            isLoading: false,
            configFlag: false,
            eventKeyValue: [
                ['e', null],
                ['r', null],
                ['u', null],
                ['i', null],
                ['d', null],
                ['f', null],
                ['j', null],
                ['k', null],
                ['s', null],
                ['a', null],
                ['g', 'h'],
                [';', null],
                ['l', null],
                ['Enter', null],
                ['Escape', null],
                [' ', null]
            ],
            eventKeyValueDefault: [
                ['e', null],
                ['r', null],
                ['u', null],
                ['i', null],
                ['d', null],
                ['f', null],
                ['j', null],
                ['k', null],
                ['s', null],
                ['a', null],
                ['g', 'h'],
                [';', null],
                ['l', null],
                ['Enter', null],
                ['Escape', null],
                [' ', null]
            ],
            editFlag: false,
            editingRow: null,
            editingCell: null,
            editingValue: '',
            keyPressTimeoutID: null,
            HTPFlag: false,
            subMenuFlag: false,
            isHoveredTitle: false
        },
        watch: {
            answer: function (ansVal) {
                if (ansVal == this.target && this.startFlag == true) {
                    this.addDetail();
                    this.clearCount++;
                    this.answerDetail[this.questionCount].reload = false;
                    this.questionCount++;
                    this.ansFlag = true;
                    this.selectedNumIndexF = -1;
                    this.selectedNumTF = false;
                    let currentNums = [];
                    for (let i = 0; i < this.numbers.length; i++) {
                        currentNums.push(this.numbers[i]);
                    }
                    this.clearedFormula.splice(this.clearCount, 0, currentNums);
                    if (this.clearCount == 1) {
                        this.elapsedTime = Date.now() - this.startTime - this.totalPausedTime;
                        if (this.clearEffectFlag == "on") {
                            this.isLoading = true;
                            this.pauseTimer();
                            setTimeout(() => {
                                this.isLoading = false;
                            }, 1500);
                            this.correctText = "CLEAR!"
                            this.startColorChange();

                            setTimeout(() => {
                                this.showResult();
                            }, 1500);
                        } else {
                            this.showResult();
                        }
                    } else {
                        if (this.clearEffectFlag == "on") {
                            this.isLoading = true;
                            this.pauseTimer();
                            setTimeout(this.createNum, 1500);
                            setTimeout(() => {
                                this.isLoading = false;
                            }, 1500);
                            if (this.clearCount == 9) {
                                this.correctText = "LAST!"
                            } else {
                                this.correctText = "Correct!"
                            }
                            this.startColorChange();
                        } else {
                            this.createNum();
                        }
                        // const correctCube = document.getElementById("correctCube");
                        // correctCube.style.display = "block";
                        // setTimeout(() => {
                        //     this.ansFlag = false;
                        // }, 1000);
                        // setTimeout(() => {
                        //     correctCube.style.display = "";
                        // }, 1000);
                        return;
                    }
                }
            },
        },
        computed: {
            answer() {
                let text =
                    "return (" +
                    this.brackets[0] +
                    this.addSym[0] +
                    this.numbers[0] +
                    this.firstSym[0] +
                    this.brackets[1] +
                    this.numbers[1] +
                    this.brackets[2] +
                    this.secondSym[0] +
                    this.brackets[3] +
                    this.numbers[2] +
                    this.brackets[4] +
                    this.thirdSym[0] +
                    this.numbers[3] +
                    this.brackets[5] +
                    ")";
                try {
                    if (text.length >= 16) {
                        return Math.floor(Function(text)() * 10) / 10;
                    }
                } catch (e) {
                    this.resetBra();
                    text =
                        "return (" +
                        this.brackets[0] +
                        this.addSym[0] +
                        this.numbers[0] +
                        this.firstSym[0] +
                        this.brackets[1] +
                        this.numbers[1] +
                        this.brackets[2] +
                        this.secondSym[0] +
                        this.brackets[3] +
                        this.numbers[2] +
                        this.brackets[4] +
                        this.thirdSym[0] +
                        this.numbers[3] +
                        this.brackets[5] +
                        ")";

                    return Math.floor(Function(text)() * 10) / 10;
                }
            }, formattedScore() {
                const score = Number(this.score).toFixed(1); // 小数点以下1桁までの数値に変換
                return score;
            },
        },
        mounted() {
            window.addEventListener('keydown', this.handleKeyDown);
            window.addEventListener('keydown', this.handleKeyInput);
            if (localStorage.getItem('mode')) {
                document.getElementById("lunaticButton").style.pointerEvents = "auto";
                document.getElementById("lunaticButton").style.cursor = "pointer";
            }
            const storedEventKeyValue = localStorage.getItem('userEventKeyValue');
            if (storedEventKeyValue) {
                this.eventKeyValue = JSON.parse(storedEventKeyValue);
            }
            this.eventBus = new Vue();
            eventBus.$on('dataChanged', () => {
                // Airtable APIの初期化
                const Airtable = require('airtable');

                const base = new Airtable({
                    apiKey: 'keyqw2LBx6N2Ijdr2'
                }).base('app1MxnFrdKWBio9q');

                // テーブルの選択
                const table = base('RankingDetail');

                // データの取得と加工
                table.select({
                    filterByFormula: 'mode = "Easy"',
                    sort: [{ field: 'score', direction: 'desc' }]
                }).firstPage((err, records) => {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    // 各レコードの要素を配列に格納kjjkjする
                    const data = records.map(record => {
                        return [record.get('name'), record.get('score'), record.get('date'), record.get('question'), record.get('mode')];
                    });
                    // 連想配列にデータを格納する
                    this.rankingDataEasy = { data: data };
                });

                // データの取得と加工
                table.select({
                    filterByFormula: 'mode = "Normal"',
                    sort: [{ field: 'score', direction: 'desc' }]
                }).firstPage((err, records) => {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    // 各レコードの要素を配列に格納する
                    const data = records.map(record => {
                        return [record.get('name'), record.get('score'), record.get('date'), record.get('question'), record.get('mode')];
                    });
                    // 連想配列にデータを格納する
                    this.rankingDataNormal = { data: data };
                });

                // データの取得と加工
                table.select({
                    filterByFormula: 'mode = "Hard"',
                    sort: [{ field: 'score', direction: 'desc' }]
                }).firstPage((err, records) => {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    // 各レコードの要素を配列に格納する
                    const data = records.map(record => {
                        return [record.get('name'), record.get('score'), record.get('date'), record.get('question'), record.get('mode')];
                    });
                    // 連想配列にデータを格納する
                    this.rankingDataHard = { data: data };
                });

                // データの取得と加工
                table.select({
                    filterByFormula: 'mode = "Lunatic"',
                    sort: [{ field: 'score', direction: 'desc' }]
                }).firstPage((err, records) => {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    // 各レコードの要素を配列に格納する
                    const data = records.map(record => {
                        return [record.get('name'), record.get('score'), record.get('date'), record.get('question'), record.get('mode')];
                    });
                    // 連想配列にデータを格納する
                    this.rankingDataOD = { data: data };
                });
                // this.getItems();
            });
            this.eventBus = eventBus;
        }, beforeUnmount() {
            window.removeEventListener('keydown', this.handleKeyDown);
        }, beforeDestroy() {
            window.removeEventListener('keydown', this.handleKeyInput);
        },

        methods: {
            showResult() {
                this.stop();
                this.startFlag = false;
                this.subMenuFlag = true;
                this.resetNumBraSym();
                this.checkDupNums = [];
                this.clearedFormula = [];
                // this.ansNoChange();
                if (this.mode == "Easy") {
                    if (this.score < 800) {
                        this.evaluation = "Rank : D";
                        this.evalComment =
                            "Try More...";
                    } else if (this.score < 850) {
                        this.evaluation = "Rank : C";
                        this.evalComment =
                            "Rome was not built in a day.";
                    } else if (this.score < 900) {
                        this.evaluation = "Rank : B";
                        this.evalComment =
                            "Getting used to it?";
                    } else if (this.score < 950) {
                        this.evaluation = "Rank : A";
                        this.evalComment =
                            "There's always someone better.";
                    } else {
                        this.evaluation = "Rank : S"
                        this.evalComment =
                            "Good score! Please try Next mode!";
                    }
                } else if (this.mode == "Normal") {

                    if (this.score < 600) {
                        this.evaluation = "Rank : D";
                        this.evalComment =
                            "NORMAL, but this is difficult for many people...";
                    } else if (this.score < 700) {
                        this.evaluation = "Rank : C";
                        this.evalComment =
                            "Persistence pays off.";
                    } else if (this.score < 820) {
                        this.evaluation = "Rank : B";
                        this.evalComment =
                            "Perhaps you like to do mental arithmetic?";
                    } else if (this.score < 930) {
                        this.evaluation = "Rank : A";
                        this.evalComment =
                            "You are in the top 5% or so...Maybe.";
                    } else {
                        this.evaluation = "Rank - S -"
                        this.evalComment =
                            "Welcome Lunatic... And It's Lunatic Time!";
                        document.getElementById("lunaticButton").style.pointerEvents = "auto";
                        document.getElementById("lunaticButton").style.cursor = "pointer";
                        localStorage.setItem('mode', 'Lunatic');
                    }
                } else if (this.mode == "Hard") {

                    if (this.score < 550) {
                        this.evaluation = "Rank : D";
                        this.evalComment =
                            "Was this mode harder than Normal?";
                    } else if (this.score < 650) {
                        this.evaluation = "Rank : C";
                        this.evalComment =
                            "Patience is a virtue.";
                    } else if (this.score < 780) {
                        this.evaluation = "Rank : B";
                        this.evalComment =
                            "Did you play the abacus?";
                    } else if (this.score < 910) {
                        this.evaluation = "Rank : A";
                        this.evalComment =
                            "You are great, but fall just one step short...";
                    } else {
                        this.evaluation = "Rank : S"
                        this.evalComment =
                            "Welcome Lunatic... And It's Lunatic Time!";
                        document.getElementById("lunaticButton").style.pointerEvents = "auto";
                        document.getElementById("lunaticButton").style.cursor = "pointer";
                        localStorage.setItem('mode', 'Lunatic');
                    }

                } else if (this.mode == "Lunatic") {

                    if (this.score < 400) {
                        this.evaluation = "Rank : D";
                        this.evalComment =
                            "It's not your fault.";
                    } else if (this.score < 550) {
                        this.evaluation = "Rank : C";
                        this.evalComment =
                            "Adversity makes a man wise.";
                    } else if (this.score < 600) {
                        this.evaluation = "Rank : B";
                        this.evalComment =
                            "Do you remember how many times you tried?";
                    } else if (this.score < 800) {
                        this.evaluation = "Rank : A";
                        this.evalComment =
                            "Excuse me, are you a Mensa member?"

                    } else if (this.score < 950) {
                        this.evaluation = "Rank : S";
                        this.evalComment =
                            "This game is a battle against luck and yourself.";
                    } else {
                        this.evaluation = "Game Clear"
                        this.evalComment =
                            "Did you enjoy this game?";
                    }
                }
                this.resultFlag = true;
            },
            handleMouseOver() {
                this.isHoveredTitle = true;
                this.title = "Menu"
            },
            handleMouseLeave() {
                this.isHoveredTitle = false;
                if (this.mode !== "Lunatic") {
                    this.title = "10 Puzzle"
                } else {
                    this.title = this.target + "Puzzle"
                }
            },
            closeMenu() {
                this.menuFlag = false;
                this.subMenuFlag = false;
            },
            closeConfig() {
                this.configFlag = false;
            },
            getEventKeyValue(row, cell) {
                if (this.eventKeyValue[row][cell] == ' ') {
                    return 'Space'
                } else {
                    return this.eventKeyValue[row][cell];
                }
            },
            startEditing(row, cell) {
                if (this.editFlag == false) {
                    this.editFlag = true;
                    this.editingRow = row;
                    this.editingCell = cell;
                    const originalValue = this.eventKeyValue[row][cell];
                    this.eventKeyValue[row].splice(cell, 1, 'Input Key');
                    console.log(this.eventKeyValue);

                    // 3秒経過後にキャンセルする
                    this.keyPressTimeoutID = setTimeout(() => {
                        this.cancelEditing(row, cell, originalValue);
                    }, 3000);

                    window.addEventListener('keydown', this.handleKeyDownEvent);
                }
            },
            cancelEditing(row, cell, originalValue) {
                if (this.eventKeyValue[row][cell] == "Input Key") {
                    this.eventKeyValue[row].splice(cell, 1, originalValue);
                    this.editingRow = null;
                    this.editingCell = null;
                    window.removeEventListener('keydown', this.handleKeyDownEvent);
                }
                clearTimeout(this.keyPressTimeoutID);
                this.editFlag = false;
            },
            setEventKeyValue(row, cell) {
                if (this.editingValue !== '') {
                    this.eventKeyValue[row][cell] = this.editingValue;
                }
            },
            handleKeyDownEvent(event) {
                event.preventDefault();
                const key = event.key;
                // すでに存在する場合はnullに設定
                for (let i = 0; i < this.eventKeyValue.length; i++) {
                    const row = this.eventKeyValue[i];
                    for (let j = 0; j < row.length; j++) {
                        if (row[j] === key) {
                            this.eventKeyValue[i].splice(j, 1, null);
                        }
                    }
                }

                this.eventKeyValue[this.editingRow].splice(this.editingCell, 1, key);
                clearTimeout(this.keyPressTimeoutID);
                localStorage.setItem('userEventKeyValue', JSON.stringify(this.eventKeyValue));
                this.editingRow = null;
                this.editingCell = null;
                window.removeEventListener('keydown', this.handleKeyDownEvent);
                this.editFlag = false;
            },
            handleKeyDown(event) {
                if (event.key == "Enter") {
                    event.preventDefault();
                }
                if (!this.subMenuFlag) {
                    if (this.startFlag && !this.isPaused) {
                        event.preventDefault();
                        if (event.key === this.eventKeyValue[0][0] || event.key === this.eventKeyValue[0][1]) {
                            if (this.addSym[0] == "+") {
                                this.addSym.splice(0, 1, "-");
                            } else {
                                this.addSym.splice(0, 1, "+");
                            }
                        } else if (event.key === this.eventKeyValue[1][0] || event.key === this.eventKeyValue[1][1]) {
                            this.symValue[0] = this.getNextSymbol(this.symValue[0]);
                            if (this.symValue[0] == "×") {
                                this.firstSym.splice(0, 1, "*");
                            } else if (this.symValue[0] == "÷") {
                                this.firstSym.splice(0, 1, "/");
                            } else {
                                this.firstSym.splice(0, 1, this.symValue[0]);
                            };
                        } else if (event.key === this.eventKeyValue[2][0] || event.key === this.eventKeyValue[2][1]) {
                            this.symValue[1] = this.getNextSymbol(this.symValue[1]);
                            if (this.symValue[1] == "×") {
                                this.secondSym.splice(0, 1, "*");
                            } else if (this.symValue[1] == "÷") {
                                this.secondSym.splice(0, 1, "/");
                            } else {
                                this.secondSym.splice(0, 1, this.symValue[1]);
                            };
                        } else if (event.key === this.eventKeyValue[3][0] || event.key === this.eventKeyValue[3][1]) {
                            this.symValue[2] = this.getNextSymbol(this.symValue[2]);
                            if (this.symValue[2] == "×") {
                                this.thirdSym.splice(0, 1, "*");
                            } else if (this.symValue[2] == "÷") {
                                this.thirdSym.splice(0, 1, "/");
                            } else {
                                this.thirdSym.splice(0, 1, this.symValue[2]);
                            };
                        } else if (event.key === this.eventKeyValue[4][0] || event.key === this.eventKeyValue[4][1]) {
                            this.numReplace('first');
                        } else if (event.key === this.eventKeyValue[5][0] || event.key === this.eventKeyValue[5][1]) {
                            this.numReplace('second');
                        } else if (event.key === this.eventKeyValue[6][0] || event.key === this.eventKeyValue[6][1]) {
                            this.numReplace('third');
                        } else if (event.key === this.eventKeyValue[7][0] || event.key === this.eventKeyValue[7][1]) {
                            this.numReplace('fourth');
                        } else if (event.key === this.eventKeyValue[8][0] || event.key === this.eventKeyValue[8][1]) {
                            // 左二つ
                            this.braChange(0);
                        } else if (event.key === this.eventKeyValue[10][0] || event.key === this.eventKeyValue[10][1]) {
                            // 真ん中二つ
                            this.braChange(1);
                        } else if (event.key === this.eventKeyValue[12][0] || event.key === this.eventKeyValue[12][1]) {
                            // 左みっつ
                            this.braChange(3);
                        } else if (event.key === this.eventKeyValue[9][0] || event.key === this.eventKeyValue[9][1]) {
                            // 右二つ
                            this.braChange(4);
                        } else if (event.key === this.eventKeyValue[11][0] || event.key === this.eventKeyValue[11][1]) {
                            // 右みっつ
                            this.braChange(5);
                        } else if (event.key === this.eventKeyValue[14][0] || event.key === this.eventKeyValue[14][1]) {
                            if (!this.disableButton && this.reloadCount !== 0) {
                                this.reloadClick();
                                this.createNum();
                            }
                        } else if (event.key === this.eventKeyValue[13][0] || event.key === this.eventKeyValue[13][1]) {
                            if (this.checkDetailFlag) {
                                this.closeDetail();
                            } else {
                                this.startOrGiveUp();
                            }
                        } else if (event.key === this.eventKeyValue[15][0] || event.key === this.eventKeyValue[15][1]) {
                            this.resetFormula();
                        }
                    } else if (event.key === this.eventKeyValue[13][0] || event.key === this.eventKeyValue[13][1]) {
                        this.startOrGiveUp();
                    }
                    else if (event.key === 'z') {
                        this.showResult();
                    }
                } else if (this.checkDetailFlag && (event.key === this.eventKeyValue[13][0] || event.key === this.eventKeyValue[13][1])) {
                    this.closeDetail();
                }
            },
            clearEffectChange() {
                if (this.clearEffectFlag == "on") {
                    this.clearEffectFlag = "off";
                } else {
                    this.clearEffectFlag = "on";
                }
            },
            correctProcess() {
                this.showCorrect = true; // フェードイン開始
                // 1秒後にフェードインを終了
                setTimeout(() => {
                    this.showCorrect = false; // 要素を非表示にする
                }, 1000);

            },
            getNextSymbol(symbol) {
                const symbols = ["-", "×", "÷", "+"];
                const currentIndex = symbols.indexOf(symbol);
                const nextIndex = (currentIndex + 1) % symbols.length;
                return symbols[nextIndex];
            },
            startDrag(index, event) {
                this.isDragging = true;
                this.startPosition.x = event.clientX;
                this.startPosition.y = event.clientY;
                this.selectedSym = index;
            },
            changeOpeClick(number) {
                if (this.inputMode == "Click") {
                    if (number == 0) {
                        this.symValue[0] = this.getNextSymbol(this.symValue[0]);
                        if (this.symValue[0] == "×") {
                            this.firstSym.splice(0, 1, "*");
                        } else if (this.symValue[0] == "÷") {
                            this.firstSym.splice(0, 1, "/");
                        } else {
                            this.firstSym.splice(0, 1, this.symValue[0]);
                        };
                    } else if (number == 1) {
                        this.symValue[1] = this.getNextSymbol(this.symValue[1]);
                        if (this.symValue[1] == "×") {
                            this.secondSym.splice(0, 1, "*");
                        } else if (this.symValue[1] == "÷") {
                            this.secondSym.splice(0, 1, "/");
                        } else {
                            this.secondSym.splice(0, 1, this.symValue[1]);
                        };
                    } else if (number == 2) {
                        this.symValue[2] = this.getNextSymbol(this.symValue[2]);
                        if (this.symValue[2] == "×") {
                            this.thirdSym.splice(0, 1, "*");
                        } else if (this.symValue[2] == "÷") {
                            this.thirdSym.splice(0, 1, "/");
                        } else {
                            this.thirdSym.splice(0, 1, this.symValue[2]);
                        };
                    }
                }
            },
            drag(event) {
                if (this.isDragging && this.inputMode == 'Flick') {
                    this.position.x = this.position.x + event.clientX - this.startPosition.x;
                    this.position.y = this.position.y + event.clientY - this.startPosition.y;
                    this.startPosition.x = event.clientX;
                    this.startPosition.y = event.clientY;

                    if (this.lastMousePos) {
                        const deltaX = event.clientX - this.lastMousePos.x;
                        if (Math.abs(deltaX) >= this.mouseThreshold) {
                            if (deltaX > 0) {
                                this.symValue[this.selectedSym] = "+";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "+");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "+");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "+");
                                        break;
                                }
                            } else {
                                this.symValue[this.selectedSym] = "-";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "-");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "-");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "-");
                                        break;
                                }
                            }
                            this.lastMousePos.x = event.clientX;
                        }

                        const deltaY = event.clientY - this.lastMousePos.y;
                        if (Math.abs(deltaY) >= this.mouseThreshold) {
                            if (deltaY > 0) {
                                this.symValue[this.selectedSym] = "÷";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "/");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "/");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "/");
                                        break;
                                }
                            } else {
                                this.symValue[this.selectedSym] = "×";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "*");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "*");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "*");
                                        break;
                                }
                            }
                            this.lastMousePos.y = event.clientY;
                        }
                    } else {
                        this.lastMousePos = { x: event.clientX, y: event.clientY };
                    }
                }
            },
            endDrag() {
                this.isDragging = false;
                this.lastMousePos = null;
            },
            selectSym(index) {
                this.selectedSym = index;
            },
            modeChangeEasy() {
                this.mode = "Easy";
                this.title = "10 Puzzle";
                this.btnIsSelect.splice(3, 1, false);
                this.btnIsSelect.splice(4, 1, false);
                this.btnIsSelect.splice(5, 1, false);
                this.btnIsSelect.splice(6, 1, true);
                this.tryAgain();
                this.target = 10;
            },
            modeChangeNormal() {
                this.mode = "Normal";
                this.title = "10 Puzzle";
                this.btnIsSelect.splice(3, 1, true);
                this.btnIsSelect.splice(4, 1, false);
                this.btnIsSelect.splice(5, 1, false);
                this.btnIsSelect.splice(6, 1, false);
                this.tryAgain();
                this.target = 10;
            },
            modeChangeHard() {
                this.mode = "Hard";
                this.title = "10 Puzzle";
                this.btnIsSelect.splice(3, 1, false);
                this.btnIsSelect.splice(4, 1, true);
                this.btnIsSelect.splice(5, 1, false);
                this.btnIsSelect.splice(6, 1, false);
                this.tryAgain();
                this.target = 10;
            },
            modeChangeLunatic() {
                this.mode = "Lunatic";
                this.title = "Number Puzzle";
                this.btnIsSelect.splice(3, 1, false);
                this.btnIsSelect.splice(4, 1, false);
                this.btnIsSelect.splice(5, 1, true);
                this.btnIsSelect.splice(6, 1, false);
                this.tryAgain();
            },
            //startボタン押下時、もしくはanswer==10の時に数値を変更
            matchCreateNum(nums) {
                if (this.mode !== "Easy") {
                    if (this.checkEasyAnswer(nums, this.target)) {
                        return false;
                    }
                }

                // 配列を小さい順に並べ替える
                nums.sort((a, b) => a - b);
                // 過去の問題と重複が無いか確かめる
                for (let i = 0; i < this.checkDupNums.length; i++) {
                    if (this.areArraysEqual(nums, this.checkDupNums[i])) {
                        // console.log(nums + "は重複しています")
                        return false;
                    }
                }

                return true;

            }, checkEasyAnswer(nums, target) {
                if (nums[0] + nums[1] + nums[2] + nums[3] == target ||
                    // 引き算チェック
                    - nums[0] + nums[1] + nums[2] + nums[3] == target ||
                    nums[0] - nums[1] + nums[2] + nums[3] == target ||
                    nums[0] + nums[1] - nums[2] + nums[3] == target ||
                    nums[0] + nums[1] + nums[2] - nums[3] == target ||
                    // 引き算2か所チェック
                    - nums[0] - nums[1] + nums[2] + nums[3] == target ||
                    - nums[0] + nums[1] - nums[2] + nums[3] == target ||
                    - nums[0] + nums[1] + nums[2] - nums[3] == target ||
                    nums[0] - nums[1] - nums[2] + nums[3] == target ||
                    nums[0] - nums[1] + nums[2] - nums[3] == target ||
                    nums[0] + nums[1] - nums[2] - nums[3] == target ||
                    // 掛け算チェック
                    nums[0] * nums[1] + nums[2] + nums[3] == target ||
                    nums[0] * nums[2] + nums[1] + nums[3] == target ||
                    nums[0] * nums[3] + nums[2] + nums[1] == target ||
                    nums[0] + nums[1] * nums[2] + nums[3] == target ||
                    nums[0] + nums[1] * nums[3] + nums[2] == target ||
                    nums[0] + nums[1] + nums[2] * nums[3] == target ||
                    // 割り算チェック（番号--小÷大）
                    nums[0] / nums[1] + nums[2] + nums[3] == target ||
                    nums[0] / nums[2] + nums[1] + nums[3] == target ||
                    nums[0] / nums[3] + nums[2] + nums[1] == target ||
                    nums[0] + nums[1] / nums[2] + nums[3] == target ||
                    nums[0] + nums[1] / nums[3] + nums[2] == target ||
                    nums[0] + nums[1] + nums[2] / nums[3] == target ||
                    // 割り算チェック（番号--大÷小）
                    nums[1] / nums[0] + nums[2] + nums[3] == target ||
                    nums[2] / nums[0] + nums[1] + nums[3] == target ||
                    nums[3] / nums[0] + nums[2] + nums[1] == target ||
                    nums[0] + nums[2] / nums[1] + nums[3] == target ||
                    nums[0] + nums[3] / nums[1] + nums[2] == target ||
                    nums[0] + nums[1] + nums[3] / nums[2] == target) {
                    // console.log(nums + "check失敗");
                    return true;
                };
            }, make10Easy(nums, target) {
                if (nums[0] + nums[1] + nums[2] + nums[3] == target) {
                    return false;
                }
                const condition2 = -nums[0] + nums[1] + nums[2] + nums[3] == target;
                const condition3 = nums[0] - nums[1] + nums[2] + nums[3] == target;
                const condition4 = nums[0] + nums[1] - nums[2] + nums[3] == target;
                const condition5 = nums[0] + nums[1] + nums[2] - nums[3] == target;
                const condition6 = -nums[0] - nums[1] + nums[2] + nums[3] == target;
                const condition7 = -nums[0] + nums[1] - nums[2] + nums[3] == target;
                const condition8 = -nums[0] + nums[1] + nums[2] - nums[3] == target;
                const condition9 = nums[0] - nums[1] - nums[2] + nums[3] == target;
                const condition10 = nums[0] - nums[1] + nums[2] - nums[3] == target;
                const condition11 = nums[0] + nums[1] - nums[2] - nums[3] == target;
                const condition12 = nums[0] * nums[1] + nums[2] + nums[3] == target;
                const condition13 = nums[0] * nums[2] + nums[1] + nums[3] == target;
                const condition14 = nums[0] * nums[3] + nums[2] + nums[1] == target;
                const condition15 = nums[0] + nums[1] * nums[2] + nums[3] == target;
                const condition16 = nums[0] + nums[1] * nums[3] + nums[2] == target;
                const condition17 = nums[0] + nums[1] + nums[2] * nums[3] == target;
                const condition18 = nums[0] / nums[1] + nums[2] + nums[3] == target;
                const condition19 = nums[0] / nums[2] + nums[1] + nums[3] == target;
                const condition20 = nums[0] / nums[3] + nums[2] + nums[1] == target;
                const condition21 = nums[0] + nums[1] / nums[2] + nums[3] == target;
                const condition22 = nums[0] + nums[1] / nums[3] + nums[2] == target;
                const condition23 = nums[0] + nums[1] + nums[2] / nums[3] == target;
                const condition24 = nums[1] / nums[0] + nums[2] + nums[3] == target;
                const condition25 = nums[2] / nums[0] + nums[1] + nums[3] == target;
                const condition26 = nums[3] / nums[0] + nums[2] + nums[1] == target;
                const condition27 = nums[0] + nums[2] / nums[1] + nums[3] == target;
                const condition28 = nums[0] + nums[3] / nums[1] + nums[2] == target;
                const condition29 = nums[0] + nums[1] + nums[3] / nums[2] == target;

                if (condition2) {
                    return `-${nums[0]} + ${nums[1]} + ${nums[2]} + ${nums[3]}`;
                } else if (condition3) {
                    return `${nums[0]} - ${nums[1]} + ${nums[2]} + ${nums[3]}`;
                } else if (condition4) {
                    return `${nums[0]} + ${nums[1]} - ${nums[2]} + ${nums[3]}`;
                } else if (condition5) {
                    return `${nums[0]} + ${nums[1]} + ${nums[2]} - ${nums[3]}`;
                } else if (condition6) {
                    return `-${nums[0]} - ${nums[1]} + ${nums[2]} + ${nums[3]}`;
                } else if (condition7) {
                    return `-${nums[0]} + ${nums[1]} - ${nums[2]} + ${nums[3]}`;
                } else if (condition8) {
                    return `-${nums[0]} + ${nums[1]} + ${nums[2]} - ${nums[3]}`;
                } else if (condition9) {
                    return `${nums[0]} - ${nums[1]} - ${nums[2]} + ${nums[3]}`;
                } else if (condition10) {
                    return `${nums[0]} - ${nums[1]} + ${nums[2]} - ${nums[3]}`;
                } else if (condition11) {
                    return `${nums[0]} + ${nums[1]} - ${nums[2]} - ${nums[3]}`;
                } else if (condition12) {
                    return `${nums[0]} * ${nums[1]} + ${nums[2]} + ${nums[3]}`;
                } else if (condition13) {
                    return `${nums[0]} * ${nums[2]} + ${nums[1]} + ${nums[3]}`;
                } else if (condition14) {
                    return `${nums[0]} * ${nums[3]} + ${nums[2]} + ${nums[1]}`;
                } else if (condition15) {
                    return `${nums[0]} + ${nums[1]} * ${nums[2]} + ${nums[3]}`;
                } else if (condition16) {
                    return `${nums[0]} + ${nums[1]} * ${nums[3]} + ${nums[2]}`;
                } else if (condition17) {
                    return `${nums[0]} + ${nums[1]} + ${nums[2]} * ${nums[3]}`;
                } else if (condition18) {
                    return `${nums[0]} / ${nums[1]} + ${nums[2]} + ${nums[3]}`;
                } else if (condition19) {
                    return `${nums[0]} / ${nums[2]} + ${nums[1]} + ${nums[3]}`;
                } else if (condition20) {
                    return `${nums[0]} / ${nums[3]} + ${nums[2]} + ${nums[1]}`;
                } else if (condition21) {
                    return `${nums[0]} + ${nums[1]} / ${nums[2]} + ${nums[3]}`;
                } else if (condition22) {
                    return `${nums[0]} + ${nums[1]} / ${nums[3]} + ${nums[2]}`;
                } else if (condition23) {
                    return `${nums[0]} + ${nums[1]} + ${nums[2]} / ${nums[3]}`;
                } else if (condition24) {
                    return `${nums[1]} / ${nums[0]} + ${nums[2]} + ${nums[3]}`;
                } else if (condition25) {
                    return `${nums[2]} / ${nums[0]} + ${nums[1]} + ${nums[3]}`;
                } else if (condition26) {
                    return `${nums[3]} / ${nums[0]} + ${nums[2]} + ${nums[1]}`;
                } else if (condition27) {
                    return `${nums[0]} + ${nums[2]} / ${nums[1]} + ${nums[3]}`;
                } else if (condition28) {
                    return `${nums[0]} + ${nums[3]} / ${nums[1]} + ${nums[2]}`;
                } else if (condition29) {
                    return `${nums[0]} + ${nums[1]} + ${nums[3]} / ${nums[2]}`;
                }
                return false;
            },
            createNum() {
                if (this.isPaused == false) {
                    this.pauseTimer();
                }
                if (this.mode == "Easy") {
                    let nums = [];
                    let result;
                    do {
                        for (let i = 0; i < 4; i++) {
                            nums[i] = Math.floor(Math.random() * 9) + 1;
                        }
                        result = this.make10Easy(nums, this.target);
                    }
                    while (!this.matchCreateNum(nums) || result === false);
                    console.log(result);
                    for (let i = 0; i < this.numbers.length; i++) {
                        this.numbers.splice(i, 1, nums[i]);
                    }
                    this.answerFormula = result;

                    // 重複が無かったので追加
                    this.checkDupNums.push(nums);

                } else if (this.mode == "Normal") {
                    let nums = [];
                    do {
                        for (let i = 0; i < 4; i++) {
                            nums[i] = Math.floor(Math.random() * 9) + 1;
                        }
                    }
                    while (!this.matchCreateNum(nums));

                    let [TrueOrFalse, make10Ans] = make10(nums, 10);
                    if (TrueOrFalse) {
                        for (let i = 0; i < this.numbers.length; i++) {
                            this.numbers.splice(i, 1, nums[i]);
                        }
                        this.answerFormula = make10Ans;

                        // 重複が無かったので追加
                        this.checkDupNums.push(nums);
                    } else {
                        this.createNum();
                        return;
                    }
                } else if (this.mode == "Hard") {
                    let nums = [];
                    do {
                        for (let i = 0; i < 4; i++) {
                            nums[i] = Math.floor(Math.random() * 19) + 1;
                        }
                    }
                    while (!nums.some(num => num >= 10) || !this.matchCreateNum(nums));

                    let [TrueOrFalse, make10Ans] = make10(nums, 10);
                    if (TrueOrFalse) {
                        for (let i = 0; i < this.numbers.length; i++) {
                            this.numbers.splice(i, 1, nums[i]);
                        }
                        this.answerFormula = make10Ans;

                        // 重複が無かったので追加
                        this.checkDupNums.push(nums);
                    } else {
                        this.createNum();
                        return;
                    }

                } else if (this.mode == "Lunatic") {
                    let nums = [];
                    do {
                        this.target = Math.floor(Math.random() * 19) + 1;
                        for (let i = 0; i < this.numbers.length; i++) {
                            nums[i] = Math.floor(Math.random() * 40 + 1) / 2;
                        }
                    }
                    while (!this.matchCreateNum(nums));

                    let [TrueOrFalse, make10Ans] = make10(nums, this.target);
                    if (TrueOrFalse) {
                        for (let i = 0; i < this.numbers.length; i++) {
                            this.numbers.splice(i, 1, nums[i]);
                        }
                        this.answerFormula = make10Ans;

                        // 重複が無かったので追加
                        this.checkDupNums.push(nums);
                    } else {
                        this.createNum();
                        return;
                    }
                }
                this.selectFlag = false;
                this.selectedNumTF = false;
                for (let i = 0; i < this.numBackChange.length; i++) {
                    this.numBackChange.splice(i, 1, false);
                    this.LunaticNBChange.splice(i, 1, false);
                }
                for (let i = 0; i < this.selectedNum.length; i++) {
                    this.selectedNum.splice(i, 1, "");
                }
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
                this.resetBra();
                this.resumeTimer();
                this.createQuestionTime = Date.now();

            },
            areArraysEqual(array1, array2) {
                const sortedArray1 = array1.slice().sort();
                const sortedArray2 = array2.slice().sort();
                for (let i = 0; i < sortedArray1.length; i++) {
                    if (sortedArray1[i] !== sortedArray2[i]) {
                        return false;
                    }
                }
                return true;
            },
            // ansCheck(make10Ans) {
            //     let plusCount = (make10Ans.match(/\+/g) || []).length;
            //     let minusCount = (make10Ans.match(/\-/g) || []).length;
            //     if (
            //         (plusCount >= 2 && make10Ans.indexOf("(") == -1) ||
            //         (plusCount == 1 && minusCount == 2)
            //     ) {
            //         // this.createNum();
            //         return false;
            //     }
            //     return true;
            // },
            changeBackgroundColor(element) {
                let opacity = 0;
                const targetOpacity = 0.5;
                const transitionDuration = 200; // 背景色の変化にかける時間（ミリ秒）
                const revertDuration = 100; // 元に戻す時間（ミリ秒）

                const originalBackgroundColor = element.style.backgroundColor; // 元の背景色を保持する

                const startTimeProcess = performance.now();

                const changeTimer = setInterval(() => {
                    const elapsedTime = performance.now() - startTimeProcess;
                    const progress = elapsedTime / transitionDuration;

                    opacity = progress * targetOpacity; // オパシティを徐々に増加させる
                    element.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;

                    if (progress >= 1) {
                        clearInterval(changeTimer); // 背景色の変化タイマーを停止する

                        // 元に戻すタイマーを開始する
                        const revertTimer = setInterval(() => {
                            const elapsedTime = performance.now() - (startTimeProcess + transitionDuration);
                            const progress = elapsedTime / revertDuration;

                            opacity = targetOpacity - progress * targetOpacity; // オパシティを徐々に減少させる
                            element.style.backgroundColor = `rgba(255, 255, 255, ${opacity})`;

                            if (progress >= 1) {
                                clearInterval(revertTimer); // 元に戻すタイマーを停止する
                                element.style.backgroundColor = originalBackgroundColor; // 元の背景色に戻す
                            }
                        }, 10);
                    }
                }, 10);
            },
            changeNextElementColor(index) {
                if (index < this.elements.length) {
                    const elementId = this.elements[index];
                    const element = document.getElementById(elementId);
                    this.changeBackgroundColor(element);
                    setTimeout(() => {
                        this.changeNextElementColor(index + 1);
                    }, 40);
                } else {
                    // 全ての要素の背景色変更が完了した後に correctProcess を呼び出す
                    this.correctProcess();
                }
            },
            startColorChange() {
                this.changeNextElementColor(0);
            },
            addDetail() {
                let data_tmp = {};
                data_tmp.intervalTime = this.questionThinkTime();
                let currentNums = [];
                for (let i = 0; i < this.numbers.length; i++) {
                    currentNums.push(this.numbers[i]);
                }
                data_tmp.formula = currentNums;
                data_tmp.answer = this.answerFormula;
                data_tmp.reload = "";
                if (this.mode == "Lunatic") {
                    data_tmp.target = this.target;
                }
                this.answerDetail.push(data_tmp);
            },
            braChange(braNumber) {
                if (this.selectedBra[braNumber] == "") {
                    if (braNumber == 0) {
                        this.brackets.splice(0, 1, "(");
                        this.brackets.splice(2, 1, ")");
                        this.selectedBra[0] = true;
                        this.selectedBra[2] = true;
                    } else if (braNumber == 1) {
                        this.brackets.splice(1, 1, "(");
                        this.brackets.splice(4, 1, ")");
                        this.selectedBra[1] = true;
                        this.selectedBra[4] = true;
                    } else if (braNumber == 2) {
                        this.brackets.splice(0, 1, "(");
                        this.brackets.splice(2, 1, ")");
                        this.selectedBra[0] = true;
                        this.selectedBra[2] = true;
                    } else if (braNumber == 3) {
                        this.brackets.splice(3, 1, "(");
                        this.brackets.splice(5, 1, ")");
                        this.selectedBra[3] = true;
                        this.selectedBra[5] = true;
                    } else if (braNumber == 4) {
                        this.brackets.splice(0, 1, "(");
                        this.brackets.splice(4, 1, ")");
                        this.selectedBra[0] = true;
                        this.selectedBra[4] = true;
                    } else {
                        this.brackets.splice(1, 1, "(");
                        this.brackets.splice(5, 1, ")");
                        this.selectedBra[1] = true;
                        this.selectedBra[5] = true;
                    }

                    // for (let i = 0; i < this.bracketNames.length; i++) {
                    //     if (this.bracketNames[i] == braNumber) {
                    //         if (this.brackets[i] == "(" || this.brackets[i] == ")") {
                    //             this.resetBra();
                    //             return;
                    //         }
                    //         if (this.mode != "Lunatic") {
                    //             this.clickAct.splice(i, 1, true);
                    //         } else {
                    //             this.LunaticCAct.splice(i, 1, true);
                    //         }
                    //         this.selectedBra.splice(i, 1, "replace");
                    //     }
                    // }
                    // this.selectFlag = true;
                } else {
                    this.resetBra();
                }
                // else if (this.selectFlag == true) {
                //     for (let i = 0; i < this.bracketNames.length; i++) {
                //         if (this.bracketNames[i] == braNumber) {
                //             this.selectedBra.splice(i, 1, "replace");
                //         }
                //         this.clickAct.splice(i, 1, false);
                //         this.LunaticCAct.splice(i, 1, false);
                //     }
                //     if (this.selectedBra.indexOf("replace") == this.selectedBra.lastIndexOf("replace")) {
                //         this.resetBra();
                //         this.selectFlag = false;
                //     } else {
                //         this.selectedBra.splice(this.selectedBra.indexOf("replace"), 1, "(");
                //         this.selectedBra.splice(this.selectedBra.lastIndexOf("replace"), 1, ")");
                //         this.brackets.splice(0, this.brackets.length);
                //         this.brackets.push(...this.selectedBra);
                //         this.selectFlag = false;
                //     }
                // }
            },
            resetFormula() {
                this.resetSym();
                this.resetBra();
                this.numbers.sort((a, b) => a - b);
            },

            resetBra() {
                for (let i = 0; i < this.brackets.length; i++) {
                    this.selectedBra.splice(i, 1, "");
                    this.brackets.splice(i, 1, "");
                    this.clickAct.splice(i, 1, false);
                    this.LunaticCAct.splice(i, 1, false);
                }
            },
            resetSym() {
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
            },
            resetConfigDefault() {
                this.eventKeyValue = this.eventKeyValueDefault.map(row => [...row]);
                localStorage.setItem('userEventKeyValue', JSON.stringify(this.eventKeyValueDefault));
            },
            numReplace(received) {
                if (this.selectedNumTF == false) {
                    for (let i = 0; i < this.numbers.length; i++) {
                        if (this.passNum[i] == received) {
                            this.selectedNum[i] = this.numbers[i];
                            if (this.mode != "Lunatic") {
                                this.numBackChange.splice(i, 1, true);
                            } else {
                                this.LunaticNBChange.splice(i, 1, true);
                            }
                            this.selectedNumIndexF = i;
                        }
                    }
                    this.selectedNumTF = true;
                } else if (this.selectedNumTF == true) {
                    for (let i = 0; i < this.numbers.length; i++) {
                        if (this.passNum[i] == received) {
                            this.selectedNum[i] = this.numbers[i];
                            let firstValue = this.selectedNum[this.selectedNumIndexF];
                            this.numbers.splice(this.selectedNumIndexF, 1, this.selectedNum[i]);
                            this.numbers.splice(i, 1, firstValue);
                        }
                    }
                    for (let i = 0; i < this.selectedNum.length; i++) {
                        this.selectedNum.splice(i, 1, "");
                    }
                    for (let i = 0; i < this.numBackChange.length; i++) {
                        this.numBackChange.splice(i, 1, false);
                        this.LunaticNBChange.splice(i, 1, false);
                    }
                    this.selectedNumIndexF = -1;
                    this.selectedNumTF = false;
                }
            },
            addSymChange() {
                if (all.addSym[0] == "+") {
                    Vue.set(all.addSym, 0, "-");
                    this.symValue.splice(3, 1, "-");
                } else if (all.addSym[0] == "-") {
                    Vue.set(all.addSym, 0, "+");
                    this.symValue.splice(3, 1, "+");
                }
            },
            reloadClick() {

                this.addDetail();
                this.answerDetail[this.questionCount].reload = true;
                if (this.reloadCount > 0) {
                    this.reloadCount--;
                }
                this.questionCount++;
                let repNums = this.numbers.concat();
                this.reloadFormula.push(repNums);
                this.reloadAnswerFormula.push(this.answerFormula);
                // ボタンを無効化する
                // this.disableButton = true;
                // setTimeout(() => {
                //     this.disableButton = false;
                // }, 1000);
            },
            tryAgain() {
                this.btnIsSelect.splice(0, 1, false);
                this.resultFlag = false;
                // answerFormula.style.display = "";
                this.clearCount = 0;
                // this.createCount = 0;
                this.reloadCount = 20;
                this.startFlag = false;
                this.ansFlag = false;
                // this.clearedFormula = [];
                this.stop();
                this.reset();
                this.resetBra();
                this.resetNumBraSym();
                // this.ansChange();
            },
            startOrGiveUp() {
                if (this.isStart == true) {

                    let data_tmp = {};

                    let solvedTime = Date.now();
                    let intervalTime = solvedTime - this.createQuestionTime;
                    intervalTime = (Math.round(intervalTime / 100) / 10).toFixed(1);
                    data_tmp.intervalTime = intervalTime;

                    let currentNums = [];
                    for (let i = 0; i < this.numbers.length; i++) {
                        currentNums.push(this.numbers[i]);
                    }

                    data_tmp.formula = currentNums;
                    data_tmp.answer = this.answerFormula;
                    if (this.mode == "Lunatic") {
                        data_tmp.target = this.target;
                    }
                    data_tmp.reload = "";
                    this.answerDetail.push(data_tmp);
                    this.answerDetail[this.questionCount].reload = true;
                    this.checkDetailFlag = true;
                    this.firstSym.splice(0, 1, "+");
                    this.secondSym.splice(0, 1, "+");
                    this.thirdSym.splice(0, 1, "+");
                    this.addSym.splice(0, 1, "+");
                    for (let i = 0; i < this.symValue.length; i++) {
                        this.symValue.splice(i, 1, "+");
                    }
                    for (let i = 0; i < this.numbers.length; i++) {
                        this.numbers.splice(i, 1, "");
                    }
                    for (let i = 0; i < 3; i++) {
                        this.btnIsSelect[i] = false;
                    }

                    this.startFlag = false;
                    this.subMenuFlag = true;
                    this.isStart = false;
                    this.isStop = true;
                    this.isReset = false;
                    this.stop();
                    // this.time = "00:00:000";
                    clearTimeout(this.timeoutId);
                    this.isStop = true;
                    this.isReset = true;
                    this.score = "1000.0";
                    this.elapsedTime = 0;
                    this.totalTime = 0;
                    this.checkDupNums = [];

                    this.selectedNumIndexF = -1;
                    this.selectedNumTF = false;
                    this.clearedFormula = [];
                } else {
                    this.start();
                    this.createNum();
                }
            },
            showHowToPlay() {
                this.subMenuFlag = true;
                this.HTPFlag = true;
            },
            closeHowToPlay() {
                if (!this.menuFlag) {
                    this.subMenuFlag = false;
                }
                this.HTPFlag = false;
            },
            rankingClose() {
                const ranking = document.getElementById("ranking");
                ranking.style.display = "none";
            },
            resetNumBraSym() {
                this.resetBra();
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
                for (let i = 0; i < this.numbers.length; i++) {
                    this.numbers.splice(i, 1, "");
                }
                for (let i = 0; i < 3; i++) {
                    this.btnIsSelect[i] = false;
                }
                this.selectedNumIndexF = -1;
                this.selectedNumTF = false;
            },
            closeResult() {
                this.subMenuFlag = false;
                this.resultFlag = false;
                this.tryAgain();
            },
            checkDetail() {
                this.subMenuFlag = true;
                this.checkDetailFlag = true;
            },
            closeDetail() {
                if (!this.resultFlag) {
                    this.subMenuFlag = false;
                }
                this.checkDetailFlag = false;
                this.registFlag = false;
            },
            closeRankingDetail() {
                this.rankingDetailFlag = false;
            },
            moveRegistScreen() {
                this.registFlag = true;
            },
            closeRegist() {
                this.checkDetailFlag = false;
                this.registFlag = false;
            },
            closeRanking() {
                this.rankingFlag = false;
            },
            regist() {
                // Airtableのクライアントライブラリ使用
                var Airtable = require('airtable');
                var base = new Airtable({ apiKey: 'keyqw2LBx6N2Ijdr2' }).base('app1MxnFrdKWBio9q');

                // 入力された名前
                let userName = document.getElementById("registName").value;
                if (userName == "") {
                    document.getElementById("warning").style.display = "block";
                    document.getElementById("normalText").style.display = "none";
                    return;
                } else {
                    // 入力内容
                    const date = new Date(); // 現在時刻
                    const year = date.getFullYear().toString().slice(-2);
                    const month = ("0" + (date.getMonth() + 1)).slice(-2);
                    const day = ("0" + date.getDate()).slice(-2);
                    const nowStr = `${year}/${month}/${day}`;

                    // プレイヤーのスコア
                    let strScore = this.score.toString();

                    // プレイヤーのmode
                    let strMode = this.mode.toString();

                    // プレイヤーの解いた問題
                    const answerDetailString = JSON.stringify(this.answerDetail);

                    // データをAirtableに保存
                    var data = {
                        name: userName,
                        score: strScore,
                        date: nowStr,
                        question: answerDetailString,
                        mode: strMode,
                    };
                    base('RankingDetail').create(data, function (err, record) {
                        if (err) {
                            console.error(err);
                            return;
                        }
                    });

                    // score順にソート
                    const table = base('RankingDetail');

                    table.select({
                        view: 'Grid view',
                        sort: [{ field: 'score', direction: 'desc' }]
                    }).firstPage(function (err, records) {
                        if (err) { console.error(err); return; }
                        // records.forEach(function (record) {
                        //     console.log('Score:', record.get('score'));
                        // });
                    });

                    // 101列目以降のデータを取得する
                    const query = { fields: [], maxRecords: 100, view: 'Grid view' };
                    for (let i = 101; i <= 200; i++) {
                        query.fields.push(`Column ${i}`);
                    }
                    // テーブルの全データを取得
                    const records = [];
                    base('RankingDetail').select(query).eachPage(function page(records, fetchNextPage) {
                        // 取得したレコードを配列に追加
                        records.forEach(record => {
                            records.push(record);
                        });
                        fetchNextPage();
                    }, function done(err) {
                        if (err) {
                            console.error(err);
                            return;
                        }
                        // 取得したレコードを削除
                        records.forEach(record => {
                            record.destroy((err, deletedRecord) => {
                                if (err) {
                                    console.error(err);
                                    return;
                                }
                                console.log('Deleted record:', deletedRecord.id);
                            });
                        });
                    });
                }
                this.subMenuFlag = false;
                this.registFlag = false;
                this.resultFlag = false;
            },
            showMenu() {
                if (!this.isStart) {
                    this.subMenuFlag = true;
                    this.menuFlag = true;
                }
            },
            showConfig() {
                this.configFlag = true;
            },
            showRanking() {
                this.eventBus.$emit('dataChanged'); // データを初期化するために dataChanged イベントを発生させる
                this.rankingFlag = true;
            },
            showUserQuestion(index) {
                this.rankingDetailFlag = true;
                let userDetailTmp = [];
                switch (this.rankingDisplayMode[this.modeIndex]) {
                    case "Easy":
                        userDetailTmp = this.rankingDataEasy.data[index];
                        this.rankingUserDetail = JSON.parse(userDetailTmp[3]);
                        eventBus.$emit('dataChanged');
                        break;
                    case "Normal":
                        userDetailTmp = this.rankingDataNormal.data[index];
                        this.rankingUserDetail = JSON.parse(userDetailTmp[3]);
                        eventBus.$emit('dataChanged');
                        break;
                    case "Hard":
                        userDetailTmp = this.rankingDataHard.data[index];
                        this.rankingUserDetail = JSON.parse(userDetailTmp[3]);
                        eventBus.$emit('dataChanged');
                        break;
                    case "Lunatic":
                        userDetailTmp = this.rankingDataOD.data[index];
                        this.rankingUserDetail = JSON.parse(userDetailTmp[3]);
                        eventBus.$emit('dataChanged');
                        break;
                }
                // userDetailTmp = this.rankingDataNormal.data[index];
                // console.log(userDetailTmp);
                // this.rankingUserDetail = JSON.parse(userDetailTmp[3]);
                // console.log(this.rankingUserDetail);
                // eventBus.$emit('dataChanged');
            },
            inputModeChange() {
                if (this.inputMode == "Click") {
                    this.inputMode = "Flick";
                } else {
                    this.inputMode = "Click";
                }
            },
            rankingModeChange() {
                switch (this.rankingDisplayMode[this.modeIndex]) {
                    case "Easy":
                        this.modeIndex = (this.modeIndex + 1) % this.rankingDisplayMode.length;
                        this.showRankingEasy = false;
                        this.showRankingNormal = true;
                        this.showRankingHard = false;
                        this.showRankingLunatic = false;
                        break;
                    case "Normal":
                        this.modeIndex = (this.modeIndex + 1) % this.rankingDisplayMode.length;
                        this.showRankingEasy = false;
                        this.showRankingNormal = false;
                        this.showRankingHard = true;
                        this.showRankingLunatic = false;
                        break;
                    case "Hard":
                        this.modeIndex = (this.modeIndex + 1) % this.rankingDisplayMode.length;
                        this.showRankingEasy = false;
                        this.showRankingNormal = false;
                        this.showRankingHard = false;
                        this.showRankingLunatic = true;
                        break;
                    case "Lunatic":
                        this.modeIndex = (this.modeIndex + 1) % this.rankingDisplayMode.length;
                        this.showRankingEasy = true;
                        this.showRankingLunatic = false;
                        this.showRankingHard = false;
                        this.showRankingNormal = false;
                        break;
                }
            },
            getItems() {
                const storage = window.localStorage;
                let rankingData = Object.entries(storage)
                    .sort(([key1], [key2]) => key2 - key1)
                    .map(([key, value]) => ({ key, value: JSON.parse(value) }));
                this.rankingData = rankingData;
                let rankingDisplayData = this.rankingData.key;
            },
            // ansChange() {
            //     this.answerChangeFlag = false;
            // },
            // ansNoChange() {
            //     this.answerChangeFlag = true;
            // },
            countUp() {
                if (this.isPaused) {
                    return; // タイマーが一時停止中は処理を中断
                }
                else if (this.score <= 0) {
                    this.startOrGiveUp();
                    return;
                }

                const reCalcTime = Date.now() - this.totalPausedTime;
                this.elapsedTime = new Date(reCalcTime - this.startTime);
                this.elapsedTime = Math.round((this.elapsedTime) / 100) / 10;

                this.score = 1000 - (this.elapsedTime + 10 * (20 - (this.reloadCount)));

                // const elapsedTime = Date.now() - this.totalPausedTime;
                // const d = new Date(elapsedTime - this.startTime);
                // const m = String(d.getMinutes()).padStart(2, "0");
                // const s = String(d.getSeconds()).padStart(2, "0");
                // const ms = String(d.getMilliseconds()).padStart(3, "0");
                // this.time = `${m}:${s}:${ms}`;
                this.timeoutId = setTimeout(() => {
                    this.countUp();
                }, 10);

            }, pauseTimer() {
                clearTimeout(this.timeoutId);
                this.isPaused = true;
                this.pausedTimeStart = Date.now()
            },
            resumeTimer() {
                if (this.startTime == 0) {
                    this.startTime = Date.now();
                } else {
                    this.pausedTimeEnd = Date.now();
                    this.totalPausedTime += this.pausedTimeEnd - this.pausedTimeStart
                    // console.log("総停止時間は" + this.totalPausedTime)
                }
                this.isPaused = false;
                this.countUp();
            },
            setButtonStateInitial() {
                this.isStart = false;
                this.isStop = true;
                this.isReset = true;
            },
            setButtonStateRunning() {
                this.isStart = true;
                this.isStop = false;
                this.isReset = true;
            },
            setButtonStateStopped() {
                this.isStart = false;
                this.isStop = true;
                this.isReset = false;
            },
            start() {
                this.clearCount = 0;
                this.btnIsSelect.splice(0, 1, true);
                this.reloadCount = 20;
                this.questionCount = 0;
                this.startFlag = true;
                this.ansFlag = false;
                this.clearedFormula = [];
                this.reloadFormula = [];
                this.reloadAnswerFormula = [];
                this.answerDetail = [];
                this.setButtonStateRunning();
                this.startTime = 0;
                this.totalPausedTime = 0;
                this.pausedTimeEnd = 0;
                this.pausedTimeStart = 0;
                this.isPaused = false;
                this.createQuestionTime = Date.now();
            },
            stop() {
                if (this.isStop) {
                    return;
                }
                this.setButtonStateStopped();
                clearTimeout(this.timeoutId);
                this.elapsedTime = Math.round((this.elapsedTime) / 100) / 10;

                this.score = 1000 - (this.elapsedTime + 10 * (20 - (this.reloadCount)));
            },
            questionThinkTime() {
                let solvedTime = Date.now();
                let intervalTime = solvedTime - this.createQuestionTime;
                intervalTime = (Math.round(intervalTime / 100) / 10).toFixed(1);
                return intervalTime;
            },
            reset() {
                if (this.isReset) {
                    return;
                }
                this.time = "00:00:000";
                this.setButtonStateInitial();
                this.elapsedTime = 0;
            },
        },
    });
</script>

</html>