<!DOCTYPE html>
<html>

<head>
    <title>10PUZZLE(make10Application)</title>
    <meta charset="utf-8">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="js/make10.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="area" class="area">
        <div id="particles-js">
        </div>
        <div id="all" v-bind:class="{allOverDrive:mode == 'OverDrive', all:mode != 'OverDrive'}">
            <div class="contentWrapper">
                <div id="correctCube"></div>
                <!-- <div id="explanation" class="explanation">
                    <p><span>How to Play this app</span><br>
                        Using the four arithmetic operators and parentheses,<br>
                        create an expression using the numbers<br>
                        generated by pressing the "Start" button, and make sure the answer is 10.<br>
                        In "Use one digit" mode, use numbers from 1 to 9, and in "Use under 20" mode,<br> use numbers
                        from 1 to 19 to create an expression.<br>
                        The "Over Drive" mode is released when you get a certain score in other modes.<br>
                        If you want to practice, press the "Reload" button instead of the "Start" button<br>
                        to generate the number for the mode.<br>
                        If you want to replace the numbers, click on the two numbers you want to replace.<br>
                        If you want to switch between the four arithmetic operators,<br>
                        click where you want to switch.<br>
                        The order in which they are switched is "+, -, �?, ÷".<br>
                        If you want to know the answer to the equation, click the "Show Answer" button,<br> and the
                        challenge will be aborted,<br>
                        but you will be able to see the equation for the answer.<br>
                        You can create an expression that becomes 10 with all the generated numbers.
                    </p>
                    <button id="close" class="close" v-on:click="close()">close</button>
                </div> -->
                <div id="result" class="result" v-if="resultFlag">
                    <br>
                    <div id="scoreWrap">
                        <span id="modeText">　Mode : {{mode}}　</span>
                        <div><br>　Time : {{erapsedTime}}　</div>
                        <div><br>　Reload : {{reloadCount}}　</div>
                        <div><br>　Score : {{score}}　</div>
                    </div>
                    <br><span id="evaluation">{{evaluation}}</span>
                    <span id="evalComment">
                        <br>{{evalComment}}
                    </span>
                    <div id="resultButtonWrapper">
                        <!-- <button id="tryButton" class="resultButton" v-on:click="tryAgain()">Try Again</button> -->
                        <button id="inputUser" class="resultButton" v-on:click="moveRegistScreen()">
                            Registration
                        </button>
                        <button id="checkDetail" class="resultButton" v-on:click="checkDetail()">Details</button>
                    </div>
                    <button id="closeDetail" class="closeButton" v-on:click="closeResult()">✕
                    </button>
                </div>
                <template v-if="checkDetailFlag">
                    <div id="detailScreen" class="result">
                        <span id="resultDetailTitle">Result Details</span>
                        <div v-for="(detail, index) in answerDetail"
                            v-bind:style="{ backgroundColor: detail.reload == true ? 'rgba(255, 0, 51, 0.6)' : '' }"
                            id="detailWrapper">
                            <div class="solvedNum">
                                {{"Q." + (Number(index) + 1 + "")}}
                            </div>
                            <div class="solvedFormula">
                                {{ (detail.formula).join(" : ").split('').join("") }}
                            </div>
                            <div class="detailAnswerFormula">
                                {{ (detail.answer.replace("return", "").replace(/\*/g, "×").replace(/\//g,
                                "÷")).split('').join(' ') }}
                            </div>
                            <!-- <div class="reloadCheck">
                                {{ detail.reload == true ? "�?" : ""}}
                            </div> -->
                            <div class="intervalTime">
                                {{ detail.intervalTime + "s"}}
                            </div>
                        </div>
                        <button id="closeDetail" class="closeButton" v-on:click="closeDetail()">←
                        </button>
                </template>
                <div v-if="registFlag">
                    <div id="registScreen" class="result">
                        <button id="closeRegist" class="closeButton" v-on:click="closeRegist()">←
                        </button>
                        <span id="registTitle">Ranking Registration</span>
                        <div><br>　Score : {{score}}　</div>
                        <div>
                            <input type="text" id="registName" name="registName" maxlength="15" required>
                        </div>
                        <div id="warningWrapper">
                            <p id="warning" style="display: none">
                                Enter your name!
                            </p>
                        </div>
                        <button id="registButton" class="resultButton" v-on:click="regist()">Registration
                        </button>
                    </div>
                </div>
                <div id="ranking" class="result" v-if="rankingFlag">
                    <span id="rankingTitle" class="rankingTitle">
                        Ranking
                    </span>
                    <div id="rankingItem">
                        <div id="space" class="items">

                        </div>
                        <div id="nameItem" class="items">
                            Name
                        </div>
                        <div id="scoreItem" class="items">
                            Score
                        </div>
                        <div id="dateItem" class="items">
                            Date
                        </div>
                    </div>
                    <div id="rankingContent" class="rankingContent">
                        <div id="rankDetail" class="rankDetail" v-for="(data, index, key) in rankingData" :key="key">
                            <div id="rankNum" class="rankVal">
                                <span>
                                    {{ index + 1 }}
                                </span>
                            </div>
                            <div id="rankName" class="rankVal">
                                <span>
                                    {{ data.key }}
                                </span>
                            </div>
                            <div id="rankScore" class="rankVal">
                                <span>
                                    {{ data.value[0].score }}
                                </span>
                            </div>
                            <div id="rankDate" class="rankVal">
                                <span>
                                    {{ data.value[0].date }}
                                </span>
                            </div>
                        </div>
                    </div>
                    <button id="closeRanking" class="closeButton" v-on:click="closeRanking()">✕
                    </button>
                </div>
                <div id="answerFormula" class="answerFormula">
                    {{answerFormula}}={{target}}<br>
                    <button id="tryButton" class="tryButton" v-on:click="tryAgain()">Try Again</button>
                </div>
                <div id="answerNoChange" class="answerNoChange" v-if="answerChangeFlag">
                </div>
                <div id="header" v-on:click="showRanking()">
                    <div id="title" v-bind:class="{'overDriveTitle':mode == 'OverDrive', 'title':mode != 'OverDrive'}">
                        {{ title }}
                    </div>
                </div>
                <div id="clearCount"
                    v-bind:class="{'overDriveCount':mode == 'OverDrive', 'clearCount':mode != 'OverDrive'}">
                    Clear:　{{ clearCount }}/10　Reload:　{{ reloadCount }}
                    <p id="targetNum"
                        v-bind:class="{'overDriveCount':mode == 'OverDrive', 'targetNum':mode != 'OverDrive'}">
                        　Target:　{{target}}</p>
                </div>
                <div id="formulaBody">
                    <div @mouseenter="isHovered0 = true" @mouseleave="isHovered0 = false"
                        v-bind:class="{'hovered0': isHovered0, 'hovered3': isHovered3, 'overDriveBra':mode == 'OverDrive', 'brackets formula':mode != 'OverDrive'}"
                        v-on:click="braChange(0)">
                        {{ brackets[0] }}
                    </div>

                    <div v-bind:class="{'overDriveSym':mode == 'OverDrive', 'symbol formula':mode != 'OverDrive'}"
                        id="addSym" v-on:click="addSymChange">
                        {{ addSym[0] }}
                    </div>

                    <div type="text"
                        v-bind:class="{'overDriveCAct':overDriveNBChange[0], 'clickAct':numBackChange[0], 'overDriveNum':mode == 'OverDrive', 'numbers formula':mode != 'OverDrive'}"
                        id="firstN" v-on:click="numReplace('first')">
                        {{ numbers[0]}}
                    </div>

                    <div id="firstSymbol" class="symbol" :class="{dragging: isDragging && selectedSym === 0 }"
                        @mousedown="startDrag(0, $event)" @mousemove="drag($event)" @mouseup="endDrag"
                        @mouseleave="endDrag" @click="selectSym(0)" ref="draggable0">
                        {{ symValue[0] }}
                    </div>

                    <div @mouseenter="isHovered1 = true" @mouseleave="isHovered1 = false"
                        v-bind:class="{'hovered1': isHovered1, 'hovered4': isHovered4, 'overDriveBra':mode == 'OverDrive', 'brackets formula':mode != 'OverDrive'}"
                        id="secondBra" v-on:click="braChange(1)">
                        {{ brackets[1] }}
                    </div>

                    <div type="math"
                        v-bind:class="{'overDriveCAct':overDriveNBChange[1], 'clickAct':numBackChange[1], 'overDriveNum':mode == 'OverDrive', 'numbers formula':mode != 'OverDrive'}"
                        id="secondN" v-on:click="numReplace('second')">
                        {{ numbers[1] }}
                    </div>

                    <div @mouseenter="isHovered0 = true" @mouseleave="isHovered0 = false"
                        v-bind:class="{'hovered0': isHovered0,  'overDriveBra':mode == 'OverDrive', 'brackets formula':mode != 'OverDrive'}"
                        id="thirdBra" v-on:click="braChange(2)">
                        {{ brackets[2] }}
                    </div>

                    <div id="secondSymbol" class="symbol" :class="{ dragging: isDragging && selectedSym === 1 }"
                        @mousedown="startDrag(1, $event)" @mousemove="drag($event)" @mouseup="endDrag"
                        @mouseleave="endDrag" @click="selectSym(1)" ref="draggable1">
                        {{ symValue[1] }}
                    </div>

                    <div @mouseenter="isHovered2 = true" @mouseleave="isHovered2 = false"
                        v-bind:class="{'hovered2': isHovered2, 'overDriveBra':mode == 'OverDrive', 'brackets formula':mode != 'OverDrive'}"
                        id="forthBra" v-on:click="braChange(3)">
                        {{ brackets[3] }}
                    </div>

                    <div type="math"
                        v-bind:class="{'overDriveCAct':overDriveNBChange[2], 'clickAct':numBackChange[2], 'overDriveNum':mode == 'OverDrive', 'numbers formula':mode != 'OverDrive'}"
                        id="thirdN" v-on:click="numReplace('third')">
                        {{ numbers[2] }}
                    </div>

                    <div @mouseenter="isHovered3 = true" @mouseleave="isHovered3 = false"
                        v-bind:class="{'hovered1': isHovered1,  'hovered3': isHovered3, 'overDriveBra':mode == 'OverDrive', 'brackets formula':mode != 'OverDrive'}"
                        id="fifthBra" v-on:click="braChange(4)">
                        {{ brackets[4] }}
                    </div>

                    <div id="thirdSymbol" class="symbol" :class="{ dragging: isDragging && selectedSym === 2 }"
                        @mousedown="startDrag(2, $event)" @mousemove="drag($event)" @mouseup="endDrag"
                        @mouseleave="endDrag" @click="selectSym(2)" ref="draggable2">
                        {{ symValue[2] }}
                    </div>

                    <div type="math"
                        v-bind:class="{'overDriveCAct':overDriveNBChange[3], 'clickAct':numBackChange[3], 'overDriveNum':mode == 'OverDrive', 'numbers formula':mode != 'OverDrive'}"
                        id="fourthN" v-on:click="numReplace('fourth')">
                        {{ numbers[3] }}
                    </div>

                    <div @mouseenter="isHovered4 = true" @mouseleave="isHovered4 = false"
                        v-bind:class="{'hovered2': isHovered2, 'hovered4': isHovered4, 'overDriveBra':mode == 'OverDrive', 'brackets formula':mode != 'OverDrive'}"
                        id="sixthBra" v-on:click="braChange(5)">
                        {{ brackets[5] }}
                    </div>

                    <div v-bind:class="{'overDriveSym':mode == 'OverDrive', 'ecole':mode != 'OverDrive'}" id="ecole">=
                    </div>

                    <div id="answerWrap">
                        <div class="formula" id="answer"
                            v-bind:class="{'answer': mode != 'OverDrive', 'overDriveAnswer': mode == 'OverDrive'}">
                            {{answer}}
                        </div>
                    </div>
                </div>
                <div id="buttonWrapper">
                    <!-- <button type="button" id="showAnsButton" v-on:click="showAns()"
                        v-bind:class="{'inactive': isStart, 'overDriveButtons overDriveStartButton':mode == 'OverDrive', 'buttons startButton':mode != 'OverDrive'}">Show
                        Answer</button> -->
                    <button type="button" id="startButton"
                        v-on:click="isStart? giveUp() : createNum(); start(); startClick()"
                        v-bind:class="{'overDriveButtons overDriveStartButton':mode == 'OverDrive', 'buttons startButton':mode != 'OverDrive'}"><span
                            v-if="isStart">Give Up</span><span v-else>Start</span></button>
                    <button type="button"
                        v-bind:class="{'overDriveButtons overDriveReloadButton':mode == 'OverDrive', 'buttons reloadButton':mode != 'OverDrive'}"
                        id="reloadButton" v-on:click="reloadClick(); createNum()">Reload</button>
                    <button type="button"
                        v-bind:class="{'overDriveButtons overDriveResetSymButton':mode == 'OverDrive', 'buttons':mode != 'OverDrive'}"
                        id="resetButton" v-on:click="resetSym">Reset</button>
                </div>
                <div id="modeWrapper">
                    <button v-bind:class="{modeButtons: true, digitButton: true, btnIsSelect: btnIsSelect[3]}"
                        v-on:click="modeChangeDigit">Use one digit</button>
                    <button v-bind:class="{modeButtons :true, teensButton: true, btnIsSelect: btnIsSelect[4]}"
                        v-on:click="modeChangeTeens">Use under 20</button>
                    <button id="overDriveButton" v-bind:class="{modeButtons: true, btnIsSelect: btnIsSelect[5]}"
                        v-on:click="modeChangeOverDrive">OverDrive</button>
                </div>
                <div class="controls">
                    <div v-bind:class="{'overDriveTimer':mode == 'OverDrive', 'timer':mode != 'OverDrive'}">{{ time }}
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- <script src="js/backgroundCSS.js"></script> -->
    <script type="text/javascript" src="js/particles.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>
</body>
<script>
    "use strict"
    // import axios from "axios";

    var all = new Vue({
        el: "#all",
        data: {
            title: "Ten-Puzzle",
            numbers: ["", "", "", ""],
            passNum: ["first", "second", "third", "fourth", "fifth", "sixth"],
            selectedNum: ["", "", "", "", "", ""],
            numBackChange: [false, false, false, false, false, false],
            overDriveNBChange: [false, false, false, false, false, false],
            selectedNumIndexF: -1,
            selectedNumTF: false,
            bracketNames: [
                "firstBra",
                "secondBra",
                "thirdBra",
                "fourthBra",
                "fifthBra",
                "sixthBra",
            ],
            brackets: ["", "", "", "", "", ""],
            selectedBra: ["", "", "", "", "", ""],
            isHovered0: false,
            isHovered1: false,
            isHovered2: false,
            isHovered3: false,
            isHovered4: false,
            isHovered5: false,
            firstSym: ["+"],
            secondSym: ["+"],
            thirdSym: ["+"],
            addSym: ["+"],
            symValue: ["+", "+", "+"],
            clearCount: 0,
            questionCount: 0,
            clearedFormula: [
                [3, 4, 7, 8],
                [1, 1, 5, 8],
            ],
            reloadFormula: [],
            reloadAnswerFormula: [],
            answerDetail: [],
            reloadCount: 0,
            answerFormula: "",
            selectFlag: false,
            startFlag: false,
            ansFlag: false,
            cheatFlag: false,
            clickAct: [false, false, false, false, false, false],
            overDriveCAct: [false, false, false, false, false, false],
            btnIsSelect: [false, false, false, true, false, false],
            mode: "digit",
            target: 10,
            score: 0,
            evaluation: "",
            evalComment: "",
            // ネットから?
            time: "00:00:000",
            startTime: 0,
            solveTime: 0,
            erapsedTime: 0,
            isStart: false,
            isStop: true,
            isReset: true,
            timeoutId: 0,
            rankingFlag: false,
            resultFlag: true,
            checkDetailFlag: true,
            registFlag: false,
            answerChangeFlag: false,
            rankingData: [],
            isDragging: false,
            startPosition: { x: 0, y: 0 },
            position: { x: 0, y: 0 },
            lastMousePos: null,
            mouseThreshold: 10,
            selectedSym: null,
            apiKey:
                "patLECZIq2tF3NhKk.e5c426974a99e1e06e1d6e6122d6a76cdb76996c9115fb96316c1471092e11d1",
            baseId: "app1MxnFrdKWBio9q",
            tableName: "name",
        },
        watch: {
            answer: function (ansVal) {
                if (ansVal == this.target && this.startFlag == true) {
                    this.clearCount++;
                    this.addDetail();
                    this.answerDetail[this.questionCount].reload = false;
                    this.questionCount++;
                    if (this.ansFlag == true && ansVal == 1) {
                        this.cheatFlag = true;
                    }
                    this.ansFlag = true;
                    this.selectedNumIndexF = -1;
                    this.selectedNumTF = false;
                    let currentNums = [];
                    for (let i = 0; i < this.numbers.length; i++) {
                        currentNums.push(this.numbers[i]);
                    }
                    this.clearedFormula.splice(this.clearCount, 0, currentNums);
                    if (this.clearCount == 1) {
                        this.stop();
                        this.startFlag = false;
                        console.log("The problems you have solved is\n");
                        for (let i = 0; i < this.clearedFormula.length; i++) {
                            console.log(this.clearedFormula[i] + "\n");
                        }
                        for (let i = 0; i < this.reloadFormula.length; i++) {
                            console.log(this.reloadFormula[i] + "\n");
                            console.log("Answer:" + this.reloadAnswerFormula[i] + "\n");
                        }
                        this.resetNumBraSym();
                        this.clearedFormula = [];
                        this.ansNoChange();
                        if (this.cheatFlag == true) {
                            this.evaluation = "Cheetah";
                            this.evalComment =
                                "You solved this like a cheetah speed, but don't be a cheater.";
                        } else if (this.score < 700) {
                            this.evaluation = "Slug";
                            if (this.mode == "digit") {
                                this.evalComment = "Try More...";
                            } else if (this.mode == "under20") {
                                this.evalComment = "Try More...";
                            } else {
                                this.evalComment =
                                    "It's just great to be able to clear it without throwing up.";
                            }
                        } else if (700 < this.score && this.score < 750) {
                            this.evaluation = "Hermit Crab";
                            if (this.mode == "digit") {
                                this.evalComment = "Keep it Up!!!";
                            } else if (this.mode == "under20") {
                                this.evalComment = "Keep it Up!";
                            } else {
                                this.evalComment = "You are doing well.";
                            }
                        } else if (750 < this.score && this.score < 850) {
                            this.evaluation = "Gentoo Penguin";
                            if (this.mode == "digit") {
                                this.evalComment = "You were almost there! Come on, man!";
                            } else if (this.mode == "under20") {
                                this.evalComment = "Good luck in the next mode!";
                                document.getElementById("overDriveButton").style.pointerEvents = "auto";
                                document.getElementById("overDriveButton").style.cursor = "pointer";
                                // localStorage.setItem('mode', 'overDrive');
                            } else {
                                this.evalComment = "Very well done. You also need luck.";
                            }
                        } else if (850 < this.score && this.score < 910) {
                            document.getElementById("overDriveButton").style.pointerEvents = "auto";
                            document.getElementById("overDriveButton").style.cursor = "pointer";
                            // localStorage.setItem('mode', 'overDrive');
                            this.evaluation = "Black Mamba";
                            if (this.mode == "digit") {
                                this.evalComment = "Congratu! You are now ready to take on new levels!";
                            } else if (this.mode == "under20") {
                                this.evalComment = "Excellent! You are now ready to take on new levels!";
                            } else {
                                this.evalComment = "You have a great talent. I envy you.";
                            }
                        } else if (910 < this.score && this.score < 940) {
                            document.getElementById("overDriveButton").style.pointerEvents = "auto";
                            document.getElementById("overDriveButton").style.cursor = "pointer";
                            // localStorage.setItem('mode', 'overDrive');
                            this.evaluation = "Springbok";
                            if (this.mode == "digit") {
                                this.evalComment = "Are you Human? You have to play OverDrive mode.";
                            } else if (this.mode == "under20") {
                                this.evalComment = "WTF Great score. Please play in the new mode.";
                            } else {
                                this.evalComment = "You're getting closer to God...";
                            }
                        } else if (940 < this.score) {
                            document.getElementById("overDriveButton").style.pointerEvents = "auto";
                            document.getElementById("overDriveButton").style.cursor = "pointer";
                            // localStorage.setItem('mode', 'overDrive');

                            this.evaluation = "Alian";
                            if (this.mode == "digit") {
                                this.evalComment = "You are Not Human... Welcome OverDrive.";
                            } else if (this.mode == "under20") {
                                this.evalComment = "HOLY... Welcome OverDrive.";
                            } else {
                                this.evalComment =
                                    "OMG I didn't think anyone else would make this score...";
                            }
                        }
                        // const result = document.getElementById("result");
                        this.resultFlag = true;
                    } else {
                        const correctCube = document.getElementById("correctCube");
                        correctCube.style.display = "block";
                        setTimeout(() => {
                            this.ansFlag = false;
                        }, 1000);
                        setTimeout(() => {
                            correctCube.style.display = "";
                        }, 1000);
                        setTimeout(this.createNum, 1000);
                        return;
                    }
                } else if (ansVal == 10) {
                    //以下、Local Storageによるランキング保??

                    //ここまでコピ???
                    const correctCube = document.getElementById("correctCube");
                    correctCube.style.display = "block";
                    setTimeout(() => {
                        correctCube.style.display = "";
                    }, 1000);
                    setTimeout(this.createNum, 1000);
                    return;
                }
            },
        },
        computed: {
            answer() {
                let text =
                    "return (" +
                    this.brackets[0] +
                    this.addSym[0] +
                    this.numbers[0] +
                    this.firstSym[0] +
                    this.brackets[1] +
                    this.numbers[1] +
                    this.brackets[2] +
                    this.secondSym[0] +
                    this.brackets[3] +
                    this.numbers[2] +
                    this.brackets[4] +
                    this.thirdSym[0] +
                    this.numbers[3] +
                    this.brackets[5] +
                    ")";
                try {
                    if (text.length >= 16) {
                        return Math.floor(Function(text)() * 10) / 10;
                    }
                } catch (e) {
                    this.resetBra();
                    text =
                        "return (" +
                        this.brackets[0] +
                        this.addSym[0] +
                        this.numbers[0] +
                        this.firstSym[0] +
                        this.brackets[1] +
                        this.numbers[1] +
                        this.brackets[2] +
                        this.secondSym[0] +
                        this.brackets[3] +
                        this.numbers[2] +
                        this.brackets[4] +
                        this.thirdSym[0] +
                        this.numbers[3] +
                        this.brackets[5] +
                        ")";

                    return Math.floor(Function(text)() * 10) / 10;
                }
            },
        },
        mounted() {
            this.getItems();
        },
        // mounted: function () {
        //     if (localStorage.getItem('mode')) {
        //         document.getElementById("overDriveButton").style.pointerEvents = "auto";
        //         document.getElementById("overDriveButton").style.cursor = "pointer";
        //     }
        // },
        methods: {
            startDrag(index, event) {
                this.isDragging = true;
                this.startPosition.x = event.clientX;
                this.startPosition.y = event.clientY;
                this.selectedSym = index;
            },
            drag(event) {
                if (this.isDragging) {
                    this.position.x = this.position.x + event.clientX - this.startPosition.x;
                    this.position.y = this.position.y + event.clientY - this.startPosition.y;
                    this.startPosition.x = event.clientX;
                    this.startPosition.y = event.clientY;

                    if (this.lastMousePos) {
                        const deltaX = event.clientX - this.lastMousePos.x;
                        if (Math.abs(deltaX) >= this.mouseThreshold) {
                            if (deltaX > 0) {
                                this.symValue[this.selectedSym] = "-";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "-");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "-");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "-");
                                        break;
                                }
                            } else {
                                this.symValue[this.selectedSym] = "+";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "+");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "+");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "+");
                                        break;
                                }
                            }
                            this.lastMousePos.x = event.clientX;
                        }

                        const deltaY = event.clientY - this.lastMousePos.y;
                        if (Math.abs(deltaY) >= this.mouseThreshold) {
                            if (deltaY > 0) {
                                this.symValue[this.selectedSym] = "÷";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "/");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "/");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "/");
                                        break;
                                }
                            } else {
                                this.symValue[this.selectedSym] = "×";
                                switch (this.selectedSym) {
                                    case 0:
                                        this.firstSym.splice(0, 1, "*");
                                        break;
                                    case 1:
                                        this.secondSym.splice(0, 1, "*");
                                        break;
                                    case 2:
                                        this.thirdSym.splice(0, 1, "*");
                                        break;
                                }
                            }
                            this.lastMousePos.y = event.clientY;
                        }
                    } else {
                        this.lastMousePos = { x: event.clientX, y: event.clientY };
                    }
                }
            },
            endDrag() {
                this.isDragging = false;
                this.lastMousePos = null;
            },
            selectSym(index) {
                this.selectedSym = index;
            },
            modeChangeDigit() {
                this.mode = "digit";
                this.title = "Ten Puzzle";
                this.btnIsSelect.splice(3, 1, true);
                this.btnIsSelect.splice(4, 1, false);
                this.btnIsSelect.splice(5, 1, false);
                this.tryAgain();
                this.target = 10;

                const area = document.getElementById("area");
                area.classList.remove("overDriveArea");
                area.classList.add("area");
                const circles = document.getElementById("circles");
                circles.classList.remove("overDriveCircles");
                circles.classList.add("circles");

                var wave = document.getElementById("wave");
                wave.style.display = "none";
                var waveCanvas = document.getElementById("waveCanvas");
                waveCanvas.style.display = "none";
            },
            modeChangeTeens() {
                this.mode = "under20";
                this.title = "Ten Puzzle";
                this.btnIsSelect.splice(3, 1, false);
                this.btnIsSelect.splice(4, 1, true);
                this.btnIsSelect.splice(5, 1, false);
                this.tryAgain();
                this.target = 10;

                const area = document.getElementById("area");
                area.classList.remove("overDriveArea");
                area.classList.add("area");
                const circles = document.getElementById("circles");
                circles.classList.remove("overDriveCircles");
                circles.classList.add("circles");

                var wave = document.getElementById("wave");
                wave.style.display = "none";
                var waveCanvas = document.getElementById("waveCanvas");
                waveCanvas.style.display = "none";
            },
            modeChangeOverDrive() {
                this.mode = "OverDrive";
                this.title = "Number Puzzle";
                this.btnIsSelect.splice(3, 1, false);
                this.btnIsSelect.splice(4, 1, false);
                this.btnIsSelect.splice(5, 1, true);
                this.tryAgain();

                const area = document.getElementById("area");
                area.classList.remove("area");
                area.classList.add("overDriveArea");
                const circles = document.getElementById("circles");
                circles.classList.remove("circles");
                circles.classList.add("overDriveCircles");
            },
            //startボタン押下時、もしくはanswer==10の時に数値をランダ??に変更
            createNum() {
                this.selectFlag = false;
                this.selectedNumTF = false;
                for (let i = 0; i < this.numBackChange.length; i++) {
                    this.numBackChange.splice(i, 1, false);
                    this.overDriveNBChange.splice(i, 1, false);
                }
                for (let i = 0; i < this.selectedNum.length; i++) {
                    this.selectedNum.splice(i, 1, "");
                }
                if (this.mode == "digit") {
                    let nums = [];
                    for (let i = 0; i < this.numbers.length; i++) {
                        nums[i] = Math.floor(Math.random() * 9) + 1;
                    }
                    if (nums[0] + nums[1] + nums[2] + nums[3] == this.target) {
                        console.log("足し算で終わったのでもう一度算出");
                        this.createNum();
                        return;
                    }
                    let [TrueOrFalse, make10Ans] = make10(nums, 10);
                    if (TrueOrFalse) {
                        console.log(TrueOrFalse);
                        for (let i = 0; i < this.numbers.length; i++) {
                            this.numbers.splice(i, 1, nums[i]);
                        }
                        this.answerFormula = make10Ans;
                        this.ansCheck();
                    } else {
                        this.createNum();
                    }
                } else if (this.mode == "under20") {
                    let nums = [];
                    for (let i = 0; i < this.numbers.length; i++) {
                        nums[i] = Math.floor(Math.random() * 19) + 1;
                    }
                    if (nums[0] + nums[1] + nums[2] + nums[3] == this.target) {
                        this.createNum();
                        return;
                    }
                    let [TrueOrFalse, make10Ans] = make10(nums, 10);
                    if (TrueOrFalse) {
                        for (let i = 0; i < this.numbers.length; i++) {
                            this.numbers.splice(i, 1, nums[i]);
                        }
                        this.answerFormula = make10Ans;
                        this.ansCheck();
                    } else {
                        this.createNum();
                    }
                } else if (this.mode == "OverDrive") {
                    let nums = [];
                    for (let i = 0; i < this.numbers.length; i++) {
                        // nums[i] = Math.floor((Math.random() * 19) + 1);
                        nums[i] = Math.floor(Math.random() * 40 + 1) / 2;
                    }
                    this.target = Math.floor((Math.random() * 60 + 1) / 2);
                    if (nums[0] + nums[1] + nums[2] + nums[3] == this.target) {
                        this.createNum();
                        return;
                    }
                    let [TrueOrFalse, make10Ans] = make10(nums, this.target);
                    if (TrueOrFalse) {
                        for (let i = 0; i < this.numbers.length; i++) {
                            this.numbers.splice(i, 1, nums[i]);
                        }
                        this.answerFormula = make10Ans;
                        this.ansCheck();
                    } else {
                        this.createNum();
                    }
                }
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
                this.resetBra();
            },
            // 記号??1か所変更のみで正解する場合??2??所を???イナスにするのみで正解する場合???数字???抽選をやり直??
            ansCheck() {
                let plusCount = (this.answerFormula.match(/\+/g) || []).length;
                let minusCount = (this.answerFormula.match(/\-/g) || []).length;
                if (
                    (plusCount >= 2 && this.answerFormula.indexOf("(") == -1) ||
                    (plusCount == 1 && minusCount == 2)
                ) {
                    console.log(this.answerFormula + " は簡単なので??り直??");
                    this.createNum();
                    return false;
                }
                return true;
            },
            addDetail() {
                let currentNums = [];
                for (let i = 0; i < this.numbers.length; i++) {
                    currentNums.push(this.numbers[i]);
                }
                let data_tmp = {};
                data_tmp.formula = currentNums;
                data_tmp.answer = this.answerFormula;
                data_tmp.intervalTime = this.questionThinkTime();
                data_tmp.reload = "";
                this.answerDetail.push(data_tmp);
            },
            braChange(braNumber) {
                if (this.selectedBra[braNumber] == "") {
                    if (braNumber == 0) {
                        this.brackets.splice(0, 1, "(");
                        this.brackets.splice(2, 1, ")");
                        this.selectedBra[0] = true;
                        this.selectedBra[2] = true;
                    } else if (braNumber == 1) {
                        this.brackets.splice(1, 1, "(");
                        this.brackets.splice(4, 1, ")");
                        this.selectedBra[1] = true;
                        this.selectedBra[4] = true;
                    } else if (braNumber == 2) {
                        this.brackets.splice(0, 1, "(");
                        this.brackets.splice(2, 1, ")");
                        this.selectedBra[0] = true;
                        this.selectedBra[2] = true;
                    } else if (braNumber == 3) {
                        this.brackets.splice(3, 1, "(");
                        this.brackets.splice(5, 1, ")");
                        this.selectedBra[3] = true;
                        this.selectedBra[5] = true;
                    } else if (braNumber == 4) {
                        this.brackets.splice(0, 1, "(");
                        this.brackets.splice(4, 1, ")");
                        this.selectedBra[0] = true;
                        this.selectedBra[4] = true;
                    } else {
                        this.brackets.splice(1, 1, "(");
                        this.brackets.splice(5, 1, ")");
                        this.selectedBra[1] = true;
                        this.selectedBra[5] = true;
                    }

                    // for (let i = 0; i < this.bracketNames.length; i++) {
                    //     if (this.bracketNames[i] == braNumber) {
                    //         if (this.brackets[i] == "(" || this.brackets[i] == ")") {
                    //             this.resetBra();
                    //             return;
                    //         }
                    //         if (this.mode != "OverDrive") {
                    //             this.clickAct.splice(i, 1, true);
                    //         } else {
                    //             this.overDriveCAct.splice(i, 1, true);
                    //         }
                    //         this.selectedBra.splice(i, 1, "replace");
                    //     }
                    // }
                    // this.selectFlag = true;
                } else {
                    this.resetBra();
                }
                //二番目に選択した括弧も??????selectedBraに反映し、Bracktsと差し替えて画面に反映
                // else if (this.selectFlag == true) {
                //     for (let i = 0; i < this.bracketNames.length; i++) {
                //         if (this.bracketNames[i] == braNumber) {
                //             this.selectedBra.splice(i, 1, "replace");
                //         }
                //         this.clickAct.splice(i, 1, false);
                //         this.overDriveCAct.splice(i, 1, false);
                //     }
                //     if (this.selectedBra.indexOf("replace") == this.selectedBra.lastIndexOf("replace")) {
                //         this.resetBra();
                //         this.selectFlag = false;
                //     } else {
                //         this.selectedBra.splice(this.selectedBra.indexOf("replace"), 1, "(");
                //         this.selectedBra.splice(this.selectedBra.lastIndexOf("replace"), 1, ")");
                //         this.brackets.splice(0, this.brackets.length);
                //         this.brackets.push(...this.selectedBra);
                //         this.selectFlag = false;
                //     }
                // }
            },
            // 全ての括弧を削除し、clickActクラスを???てfalseに
            resetBra() {
                for (let i = 0; i < this.brackets.length; i++) {
                    this.selectedBra.splice(i, 1, "");
                    this.brackets.splice(i, 1, "");
                    this.clickAct.splice(i, 1, false);
                    this.overDriveCAct.splice(i, 1, false);
                }
            },
            resetSym() {
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
            },
            //選択した数字同士の場所を置換す??
            numReplace(received) {
                if (this.selectedNumTF == false) {
                    for (let i = 0; i < this.numbers.length; i++) {
                        if (this.passNum[i] == received) {
                            this.selectedNum[i] = this.numbers[i];
                            if (this.mode != "OverDrive") {
                                this.numBackChange.splice(i, 1, true);
                            } else {
                                this.overDriveNBChange.splice(i, 1, true);
                            }
                            // 始めに選択した数値の番号をselectedNumIndexFに代入
                            this.selectedNumIndexF = i;
                        }
                    }
                    this.selectedNumTF = true;
                    // 選択された数値と位置はselectedNumに格納される
                } else if (this.selectedNumTF == true) {
                    for (let i = 0; i < this.numbers.length; i++) {
                        if (this.passNum[i] == received) {
                            this.selectedNum[i] = this.numbers[i];
                            // 始めに選択した数値をfirstValueに格??
                            let firstValue = this.selectedNum[this.selectedNumIndexF];
                            // 始めに選択した数値を後に選択した数値に置き換??
                            this.numbers.splice(this.selectedNumIndexF, 1, this.selectedNum[i]);
                            // 後に選択した数値(番号 = i)を始めに選択した数値に置き換??
                            this.numbers.splice(i, 1, firstValue);
                        }
                    }
                    for (let i = 0; i < this.selectedNum.length; i++) {
                        this.selectedNum.splice(i, 1, "");
                    }
                    for (let i = 0; i < this.numBackChange.length; i++) {
                        this.numBackChange.splice(i, 1, false);
                        this.overDriveNBChange.splice(i, 1, false);
                    }
                    this.selectedNumIndexF = -1;
                    this.selectedNumTF = false;
                }
            },
            addSymChange() {
                if (all.addSym[0] == "+") {
                    Vue.set(all.addSym, 0, "-");
                    this.symValue.splice(3, 1, "-");
                } else if (all.addSym[0] == "-") {
                    Vue.set(all.addSym, 0, "+");
                    this.symValue.splice(3, 1, "+");
                }
            },
            reloadClick() {
                if (this.startFlag == true) {
                    this.addDetail();
                    this.answerDetail[this.questionCount].reload = true;
                    this.reloadCount++;
                    this.questionCount++;
                }
                let repNums = this.numbers.concat();
                this.reloadFormula.push(repNums);
                this.reloadAnswerFormula.push(this.answerFormula);
            },
            startClick() {
                this.clearCount = 0;
                this.btnIsSelect.splice(0, 1, true);
                this.reloadCount = 0;
                this.questionCount = 0;
                this.startFlag = true;
                this.ansFlag = false;
                this.cheatFlag = false;
                this.clearedFormula = [];
                this.reloadFormula = [];
                this.reloadAnswerFormula = [];
                this.answerDetail = [];
            },
            tryAgain() {
                this.btnIsSelect.splice(0, 1, false);
                this.resultFlag = false;
                // answerFormula.style.display = "";
                this.clearCount = 0;
                // this.createCount = 0;
                this.reloadCount = 0;
                this.startFlag = false;
                this.ansFlag = false;
                this.cheatFlag = false;
                // this.clearedFormula = [];
                this.stop();
                this.reset();
                this.resetBra();
                this.resetNumBraSym();
                this.ansChange();
            },
            giveUp() {
                this.isStart = false;
                this.isStop = true;
                this.isReset = false;
                clearTimeout(this.timeoutId);
                this.time = "00:00:000";
                this.isStart = false;
                this.isStop = true;
                this.isReset = true;
                this.score = 0;
                this.erapsedTime = 0;
                let currentNums = [];
                for (let i = 0; i < this.numbers.length; i++) {
                    currentNums.push(this.numbers[i]);
                }
                let data_tmp = {};
                data_tmp.formula = currentNums;
                data_tmp.answer = this.answerFormula;

                let endTime = Date.now();
                let intervalTime = endTime - this.questionsolveTime;
                this.questionsolveTime = endTime;
                intervalTime = (Math.round(intervalTime / 100) / 10).toFixed(1);
                data_tmp.intervalTime = intervalTime;

                data_tmp.reload = "";
                this.answerDetail.push(data_tmp);
                this.answerDetail[this.questionCount].reload = true;
                this.checkDetailFlag = true;
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
                for (let i = 0; i < this.numbers.length; i++) {
                    this.numbers.splice(i, 1, "");
                }
                for (let i = 0; i < 3; i++) {
                    this.btnIsSelect[i] = false;
                }
                this.selectedNumIndexF = -1;
                this.selectedNumTF = false;
                this.clearedFormula = [];
            },
            close() {
                this.ansChange();
            },
            rankingClose() {
                const ranking = document.getElementById("ranking");
                ranking.style.display = "none";
            },
            resetNumBraSym() {
                this.resetBra();
                this.firstSym.splice(0, 1, "+");
                this.secondSym.splice(0, 1, "+");
                this.thirdSym.splice(0, 1, "+");
                this.addSym.splice(0, 1, "+");
                for (let i = 0; i < this.symValue.length; i++) {
                    this.symValue.splice(i, 1, "+");
                }
                for (let i = 0; i < this.numbers.length; i++) {
                    this.numbers.splice(i, 1, "");
                }
                for (let i = 0; i < 3; i++) {
                    this.btnIsSelect[i] = false;
                }
                this.selectedNumIndexF = -1;
                this.selectedNumTF = false;
            },
            closeResult() {
                this.resultFlag = false;
                this.tryAgain();
            },
            checkDetail() {
                this.checkDetailFlag = true;
            },
            closeDetail() {
                this.checkDetailFlag = false;
                this.registFlag = false;
            },
            moveRegistScreen() {
                this.registFlag = true;
            },
            closeRegist() {
                this.checkDetailFlag = false;
                this.registFlag = false;
            },
            closeRanking() {
                this.rankingFlag = false;
            },
            async regist() {
                let userName = document.getElementById("registName").value;
                if (userName == "") {
                    document.getElementById("warning").style.display = "block";
                    return;
                } else {
                    // 入力内容を送信する
                    const date = new Date(); // 現在時刻
                    const year = date.getFullYear().toString().slice(-2);
                    const month = ("0" + (date.getMonth() + 1)).slice(-2);
                    const day = ("0" + date.getDate()).slice(-2);
                    const nowStr = `${year}/${month}/${day}`;
                    this.answerDetail.userName = userName;
                    this.answerDetail[0].score = this.score;
                    this.answerDetail[0].date = nowStr;

                    // 配列をJSONに変換してlocalStorageに保存する?
                    // console.log(this.answerDetail);
                    // localStorage.setItem(userName, JSON.stringify(this.answerDetail));

                    this.registFlag = false;
                    this.resultFlag = false;

                    // Airtable利用
                    const url = `"https://api.airtable.com/v0/{this.baseId}/{this.tableName}" \-H "Authorization: Bearer patLECZIq2tF3NhKk.e5c426974a99e1e06e1d6e6122d6a76cdb76996c9115fb96316c1471092e11d1"`;

                    try {
                        const response = await axios.post(
                            url,
                            {
                                records: this.answerDetail.map((item) => ({
                                    fields: item,
                                })),
                            },
                            {
                                headers: {
                                    Authorization: `Bearer ${this.apiKey}`,
                                    "Content-Type": "application/json",
                                },
                            }
                        );
                        console.log(response.data);
                    } catch (error) {
                        console.log(error);
                    }
                }
            },
            showRanking() {
                this.rankingFlag = true;
                this.getItems();
                // localStorageの全??ータ表示
                for (var i = 0; i < localStorage.length; i++) {
                    // console.log(localStorage.key(i) + "の??ータは" + localStorage.getItem(localStorage.key(i)) + "\n");
                    console.log(localStorage.key(i) + localStorage.getItem(localStorage.key(i)));
                }
                console.log(this.rankingData);

                // localStorage.clear();
            },
            getItems() {
                const storage = window.localStorage;
                let rankingData = Object.entries(storage)
                    .sort(([key1], [key2]) => key2 - key1) // キーを降??に並び替??
                    .map(([key, value]) => ({ key, value: JSON.parse(value) })); // キー??に並び替??
                this.rankingData = rankingData;
                let rankingDisplayData = this.rankingData.key;
                console.log(rankingDisplayData);
            },
            ansChange() {
                this.answerChangeFlag = false;
            },
            ansNoChange() {
                this.answerChangeFlag = true;
            },
            // ネットか??
            countUp() {
                const d = new Date(Date.now() - this.startTime + this.erapsedTime);
                const m = String(d.getMinutes()).padStart(2, "0");
                const s = String(d.getSeconds()).padStart(2, "0");
                const ms = String(d.getMilliseconds()).padStart(3, "0");

                this.time = `${m}:${s}:${ms}`;
                this.timeoutId = setTimeout(() => {
                    this.countUp();
                }, 10);
            },
            setButtonStateInitial() {
                this.isStart = false;
                this.isStop = true;
                this.isReset = true;
            },
            setButtonStateRunning() {
                this.isStart = true;
                this.isStop = false;
                this.isReset = true;
            },
            setButtonStateStopped() {
                this.isStart = false;
                this.isStop = true;
                this.isReset = false;
            },
            start() {
                if (this.isStart) {
                    return;
                }
                this.questionCount = 0;
                this.setButtonStateRunning();
                this.startTime = Date.now();
                this.questionsolveTime = Date.now();
                this.countUp();
            },
            stop() {
                if (this.isStop) {
                    return;
                }
                this.setButtonStateStopped();
                clearTimeout(this.timeoutId);
                this.erapsedTime += Date.now() - this.startTime;
                this.erapsedTime = Math.round((this.erapsedTime - 9000) / 100) / 10;
                this.score = 1000 - (this.erapsedTime + 10 * this.reloadCount);
            },
            questionThinkTime() {
                let endTime = Date.now();
                let intervalTime = endTime - this.questionsolveTime;
                this.questionsolveTime = endTime;
                intervalTime = (Math.round(intervalTime / 100) / 10).toFixed(1);
                return intervalTime;
            },
            reset() {
                if (this.isReset) {
                    return;
                }
                this.time = "00:00:000";
                this.setButtonStateInitial();
                this.erapsedTime = 0;
            },
        },
    });
</script>




</html>